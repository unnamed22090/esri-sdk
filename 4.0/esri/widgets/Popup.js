// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.0/esri/copyright.txt for details.
//>>built
require({cache:{"url:esri/widgets/Popup/templates/Popup.html":'\x3cdiv role\x3d"presentation" class\x3d"${_css.invisible}"\x3e\r\n  \x3c!-- Popup Container --\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d"_containerNode" class\x3d"${_css.container} ${_css.top} ${_css.shadow}"\x3e\r\n    \x3cdiv class\x3d"${_css.main}"\x3e\r\n      \x3c!-- Popup Docked Pagination --\x3e\r\n      \x3csection class\x3d"${_css.paginationDocked}"\x3e\r\n        \x3cdiv role\x3d"presentation" class\x3d"${_css.loadingContainer}" title\x3d"${_i18n.loading}"\x3e\r\n          \x3cspan aria-hidden\x3d"true" class\x3d"${_css.icon} ${_css.loadingIcon}"\x3e\x3c/span\x3e\r\n          \x3cspan class\x3d"${_css.iconText}"\x3e${_i18n.loading}\x3c/span\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv class\x3d"${_css.paginationDockedButtons}"\x3e\r\n          \x3cdiv role\x3d"button" tabindex\x3d"0" data-dojo-attach-point\x3d"_previousDockedNode" class\x3d"${_css.btn} ${_css.previous}" title\x3d"${_i18n.previous}"\x3e\r\n            \x3cspan aria-hidden\x3d"true" class\x3d"${_css.icon} ${_css.previousIconLTR}"\x3e\x3c/span\x3e\r\n            \x3cspan aria-hidden\x3d"true" class\x3d"${_css.icon} ${_css.previousIconRTL}"\x3e\x3c/span\x3e\r\n            \x3cspan class\x3d"${_css.iconText}"\x3e${_i18n.previous}\x3c/span\x3e\r\n          \x3c/div\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"_pageTextDockedNode" class\x3d"${_css.pageText}"\x3e\x3c/div\x3e\r\n          \x3cdiv role\x3d"button" tabindex\x3d"0" data-dojo-attach-point\x3d"_nextDockedNode" class\x3d"${_css.btn} ${_css.next}" title\x3d"${_i18n.next}"\x3e\r\n            \x3cspan aria-hidden\x3d"true" class\x3d"${_css.icon} ${_css.nextIconLTR}"\x3e\x3c/span\x3e\r\n            \x3cspan aria-hidden\x3d"true" class\x3d"${_css.icon} ${_css.nextIconRTL}"\x3e\x3c/span\x3e\r\n            \x3cspan class\x3d"${_css.iconText}"\x3e${_i18n.next}\x3c/span\x3e\r\n          \x3c/div\x3e\r\n          \x3cdiv role\x3d"button" tabindex\x3d"0" data-dojo-attach-point\x3d"_pageMenuDockedNode" class\x3d"${_css.btn} ${_css.pageMenuBtn}" title\x3d"${_i18n.menu}"\x3e\r\n            \x3cspan aria-hidden\x3d"true" class\x3d"${_css.icon} ${_css.pageMenuIcon}"\x3e\x3c/span\x3e\r\n            \x3cspan class\x3d"${_css.iconText}"\x3e${_i18n.menu}\x3c/span\x3e\r\n          \x3c/div\x3e\r\n        \x3c/div\x3e\r\n      \x3c/section\x3e\r\n      \x3c!-- /Popup Docked Pagination --\x3e\r\n      \x3c!-- Popup Header --\x3e\r\n      \x3cheader class\x3d"${_css.header}"\x3e\r\n        \x3ch1 data-dojo-attach-point\x3d"_titleNode" class\x3d"${_css.title}"\x3e\x3c/h1\x3e\r\n        \x3cdiv class\x3d"${_css.headerButtons}"\x3e\r\n          \x3cdiv role\x3d"button" tabindex\x3d"0" data-dojo-attach-point\x3d"_dockNode" class\x3d"${_css.btn} ${_css.dockBtn}"\x3e\r\n            \x3cspan aria-hidden\x3d"true" class\x3d"${_css.icon} ${_css.dockIcon} ${_css.dockIconRight}"\x3e\x3c/span\x3e\r\n            \x3cspan aria-hidden\x3d"true" class\x3d"${_css.icon} ${_css.dockIcon} ${_css.dockIconTop}"\x3e\x3c/span\x3e\r\n            \x3cspan aria-hidden\x3d"true" class\x3d"${_css.icon} ${_css.dockIcon} ${_css.dockIconLeft}"\x3e\x3c/span\x3e\r\n            \x3cspan aria-hidden\x3d"true" class\x3d"${_css.icon} ${_css.dockIcon} ${_css.dockIconBottom}"\x3e\x3c/span\x3e\r\n            \x3cspan class\x3d"${_css.iconText} ${_css.dockIconText}"\x3e${_i18n.dock}\x3c/span\x3e\r\n            \x3cspan aria-hidden\x3d"true" class\x3d"${_css.icon} ${_css.undockIcon}"\x3e\x3c/span\x3e\r\n            \x3cspan class\x3d"${_css.iconText} ${_css.undockIconText}"\x3e${_i18n.undock}\x3c/span\x3e\r\n          \x3c/div\x3e\r\n          \x3cdiv role\x3d"button" tabindex\x3d"0" data-dojo-attach-point\x3d"_closeNode" class\x3d"${_css.btn} ${_css.close}" title\x3d"${_i18n.close}"\x3e\r\n            \x3cspan aria-hidden\x3d"true" class\x3d"${_css.icon} ${_css.closeIcon}"\x3e\x3c/span\x3e\r\n            \x3cspan class\x3d"${_css.iconText}"\x3e${_i18n.close}\x3c/span\x3e\r\n          \x3c/div\x3e\r\n        \x3c/div\x3e\r\n      \x3c/header\x3e\r\n      \x3c!-- /Popup Header --\x3e\r\n      \x3c!-- Popup Content --\x3e\r\n      \x3carticle class\x3d"${_css.content}" data-dojo-attach-point\x3d"_bodyContentNode"\x3e\x3c/article\x3e\r\n      \x3c!-- /Popup Content --\x3e\r\n      \x3c!-- Popup Footer --\x3e\r\n      \x3cfooter class\x3d"${_css.footer}"\x3e\r\n        \x3c!-- Popup Actions --\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"_actionsNode" class\x3d"${_css.actions}"\x3e\x3c/div\x3e\r\n        \x3c!-- /Popup Actions --\x3e\r\n        \x3c!-- Popup Pagination --\x3e\r\n        \x3csection class\x3d"${_css.pagination}"\x3e\r\n          \x3cdiv role\x3d"presentation" class\x3d"${_css.loadingContainer}" title\x3d"${_i18n.loading}"\x3e\r\n            \x3cspan aria-hidden\x3d"true" class\x3d"${_css.icon} ${_css.loadingIcon}"\x3e\x3c/span\x3e\r\n            \x3cspan class\x3d"${_css.iconText}"\x3e${_i18n.loading}\x3c/span\x3e\r\n          \x3c/div\x3e\r\n          \x3cdiv role\x3d"button" tabindex\x3d"0" data-dojo-attach-point\x3d"_previousNode" class\x3d"${_css.btn} ${_css.previous}" title\x3d"${_i18n.previous}"\x3e\r\n            \x3cspan aria-hidden\x3d"true" class\x3d"${_css.icon} ${_css.previousIconLTR}"\x3e\x3c/span\x3e\r\n            \x3cspan aria-hidden\x3d"true" class\x3d"${_css.icon} ${_css.previousIconRTL}"\x3e\x3c/span\x3e\r\n            \x3cspan class\x3d"${_css.iconText}"\x3e${_i18n.previous}\x3c/span\x3e\r\n          \x3c/div\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"_pageTextNode" class\x3d"${_css.pageText}"\x3e\x3c/div\x3e\r\n          \x3cdiv role\x3d"button" tabindex\x3d"0" data-dojo-attach-point\x3d"_nextNode" class\x3d"${_css.btn} ${_css.next}" title\x3d"${_i18n.next}"\x3e\r\n            \x3cspan aria-hidden\x3d"true" class\x3d"${_css.icon} ${_css.nextIconLTR}"\x3e\x3c/span\x3e\r\n            \x3cspan aria-hidden\x3d"true" class\x3d"${_css.icon} ${_css.nextIconRTL}"\x3e\x3c/span\x3e\r\n            \x3cspan class\x3d"${_css.iconText}"\x3e${_i18n.next}\x3c/span\x3e\r\n          \x3c/div\x3e\r\n          \x3cdiv role\x3d"button" tabindex\x3d"0" data-dojo-attach-point\x3d"_pageMenuNode" class\x3d"${_css.btn} ${_css.pageMenuBtn}" title\x3d"${_i18n.menu}"\x3e\r\n            \x3cspan aria-hidden\x3d"true" class\x3d"${_css.icon} ${_css.pageMenuIcon}"\x3e\x3c/span\x3e\r\n            \x3cspan class\x3d"${_css.iconText}"\x3e${_i18n.menu}\x3c/span\x3e\r\n          \x3c/div\x3e\r\n        \x3c/section\x3e\r\n        \x3c!-- /Popup Pagination --\x3e\r\n      \x3c/footer\x3e\r\n      \x3c!-- /Popup Footer --\x3e\r\n      \x3c!-- Popup Menu --\x3e\r\n      \x3csection class\x3d"${_css.pageMenu}" data-dojo-attach-point\x3d"_pageMenuSectionNode" aria-hidden\x3d"true"\x3e\r\n        \x3ch2 class\x3d"${_css.pageMenuHeader}" data-dojo-attach-point\x3d"_pageMenuInfoNode"\x3e\x3c/h2\x3e\r\n        \x3cnav class\x3d"${_css.pageMenuViewport}"\x3e\r\n          \x3col class\x3d"${_css.pageMenuList}" role\x3d"menu" data-dojo-attach-point\x3d"_paginationNode"\x3e\x3c/ol\x3e\r\n        \x3c/nav\x3e\r\n      \x3c/section\x3e\r\n      \x3c!-- /Popup Menu --\x3e\r\n    \x3c/div\x3e\r\n    \x3c!-- Popup Pointer --\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"_pointerNode" class\x3d"${_css.pointer}" role\x3d"presentation"\x3e\r\n      \x3cdiv class\x3d"${_css.pointerDirection} ${_css.shadow}"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3c!-- /Popup Pointer --\x3e\r\n  \x3c/div\x3e\r\n  \x3c!-- /Popup Container --\x3e\r\n\x3c/div\x3e\r\n'}});
define("./support/viewModelWiring ./Widget ./Popup/PopupViewModel ../core/HandleRegistry ../core/watchUtils ../views/2d/viewpointUtils dijit/a11yclick dijit/_TemplatedMixin dojo/keys dojo/on dojo/query dojo/Deferred dojo/i18n!./Popup/nls/Popup dojo/text!./Popup/templates/Popup.html ../core/lang dojo/_base/lang dojo/dom-class dojo/dom-attr dojo/dom-construct dojo/dom-geometry dojo/dom-style ./Popup/PopupRenderer ./Popup/PopupRendererViewModel ./Spinner ./Message".split(" "),function(f,E,F,G,n,y,s,
H,w,l,z,I,A,J,B,v,e,h,q,C,x,K,L,M,N){var c={base:"esri-popup",container:"esri-container",invisible:"esri-invisible",showDock:"esri-show-dock",docked:"esri-docked",dockedTopLeft:"esri-docked-top-left",dockedTopCenter:"esri-docked-top-center",dockedTopRight:"esri-docked-top-right",dockedBottomLeft:"esri-docked-bottom-left",dockedBottomCenter:"esri-docked-bottom-center",dockedBottomRight:"esri-docked-bottom-right",dockToLeft:"esri-dock-to-left",dockToRight:"esri-dock-to-right",dockToTop:"esri-dock-to-top",
dockToBottom:"esri-dock-to-bottom",menuOpen:"esri-menu-open",shadow:"esri-popup-shadow",main:"esri-popup-main",header:"esri-popup-header",headerButtons:"esri-popup-header-buttons",hidden:"esri-hidden",content:"esri-popup-content",showContent:"esri-show-content",footer:"esri-footer",showFooter:"esri-show-footer",title:"esri-title",showTitle:"esri-show-title",btn:"esri-button",icon:"esri-popup-icon",iconText:"esri-icon-font-fallback-text",close:"esri-close",closeIcon:"esri-close-icon esri-icon-close",
collapseIcon:"esri-down-icon esri-icon-down",dockBtn:"esri-dock",dockIcon:"esri-dock-icon",dockIconTop:"esri-icon-maximize",dockIconBottom:"esri-icon-dock-bottom",dockIconLeft:"esri-icon-dock-left",dockIconRight:"esri-icon-dock-right",dockIconText:"esri-dock-text",undockIcon:"esri-undock-icon esri-icon-minimize",undockIconText:"esri-undock-text",actions:"esri-actions",action:"esri-action",actionImage:"esri-action-image",actionText:"esri-action-text",pagination:"esri-pagination",paginationDocked:"esri-pagination-docked",
paginationDockedButtons:"esri-pagination-docked-buttons",showPagination:"esri-show-pagination",pointer:"esri-pointer",pointerDirection:"esri-pointer-direction",previous:"esri-previous",previousIconLTR:"esri-previous-icon-ltr esri-icon-left-triangle-arrow",previousIconRTL:"esri-previous-icon-rtl esri-icon-right-triangle-arrow",next:"esri-next",nextIconLTR:"esri-next-icon-ltr esri-icon-right-triangle-arrow",nextIconRTL:"esri-next-icon-rtl esri-icon-left-triangle-arrow",pageMenu:"esri-page-menu",pageMenuList:"esri-page-menu-list",
pageMenuItem:"esri-page-menu-item",pageMenuViewport:"esri-page-menu-viewport",pageMenuHeader:"esri-page-menu-header",pageMenuNote:"esri-page-menu-note",pageMenuSelected:"esri-selected",pageMenuBtn:"esri-page-menu-button",pageMenuIcon:"esri-page-menu-icon esri-icon-layer-list",pageMenuTitle:"esri-page-menu-title",pageMenuCheckMark:"esri-page-menu-check-mark esri-icon-check-mark",pageText:"esri-page-text",zoomIcon:"esri-icon-zoom-in-magnifying-glass",top:"esri-top",bottom:"esri-bottom",left:"esri-left",
right:"esri-right",hasPopupRenderer:"esri-has-popup-renderer",hasPromiseFeatures:"esri-has-promise-features",pendingPromises:"esri-pending-promises",pendingPromisesResult:"esri-pending-promises-result",featureUpdated:"esri-feature-updated",loadingContainer:"esri-loading-container",loadingIcon:"esri-rotating esri-icon-loading-indicator"},t={auto:"auto",topLeft:"top-left",topCenter:"top-center",topRight:"top-right",bottomLeft:"bottom-left",bottomCenter:"bottom-center",bottomRight:"bottom-right"},D=
{buttonEnabled:!0,position:t.auto,breakpoint:{width:544}},r={popupRenderer:"popup-renderer",acions:"actions",actionsChange:"actions-change",paginationTitles:"pagination-titles",view:"view"};return E.createSubclass([H],{properties:{actions:{dependsOn:["viewModel.actions"]},alignment:{},autoPanEnabled:{},content:{dependsOn:["viewModel.content"]},closeOnViewChangeEnabled:{},currentDockPosition:{readOnly:!0},dockOptions:{},featureCount:{dependsOn:["viewModel.featureCount"]},features:{dependsOn:["viewModel.features"]},
location:{dependsOn:["viewModel.location"]},messageEnabled:{},paginationEnabled:{},promises:{dependsOn:["viewModel.promises"]},selectedFeature:{dependsOn:["viewModel.selectedFeature"]},selectedFeatureIndex:{dependsOn:["viewModel.selectedFeatureIndex"]},spinnerEnabled:{},title:{dependsOn:["viewModel.title"]},view:{dependsOn:["viewModel.view"]},viewModel:{type:F},visible:{}},declaredClass:"esri.widgets.Popup",baseClass:c.base,templateString:J,constructor:function(){this._handleRegistry=new G;this._contentStorage=
q.create("div")},postCreate:function(){var a=this;this.inherited(arguments);var b=this.viewModel;this.own(n.whenTrue(b,"view.ready",function(){this._wireUpView(this.viewModel.view)}.bind(this)),n.init(b,"pendingPromisesCount,featureCount,promises,location",function(){var a=this.viewModel;this._displayPendingFeaturesStatus(a.pendingPromisesCount,a.featureCount,a.promises,a.location)}.bind(this)),n.init(b,"features",this._updateFeatures.bind(this)),n.init(b,"selectedFeatureIndex,selectedFeature",function(){var a=
this.viewModel;this._updateSelectedFeature(a.selectedFeature);this._updatePageText(a.features,a.selectedFeatureIndex);this._createPaginationNodes(a.features,a.selectedFeatureIndex);this._bodyContentNode.scrollTop=0}.bind(this)),n.init(b,"title",function(a){this._updateTitle(a);this.reposition()}.bind(this)),n.init(b,"actions",function(a){this._updateActions(a,this.viewModel.features);this._actionChangeListener(a)}.bind(this)),n.init(b,"content",function(a){this._updateContent(a);this.reposition()}.bind(this)),
n.init(b,"location",function(a){this._togglePopupLocationRepositioning(this.visible);this.reposition()}.bind(this)),l(this._dockNode,s,this._toggleDock.bind(this)),l(this._closeNode,s,this.close.bind(this)),l(this._previousNode,s,b.previous.bind(b)),l(this._previousDockedNode,s,b.previous.bind(b)),l(this._nextNode,s,b.next.bind(b)),l(this._nextDockedNode,s,b.next.bind(b)),l(this._pageMenuNode,s,this._togglePageMenu.bind(this)),l(this._pageMenuDockedNode,s,this._togglePageMenu.bind(this)),l(this._pageMenuInfoNode,
s,this._togglePageMenu.bind(this)),l(this._paginationNode,l.selector("li",s),function(){a._selectFeature(this)}),l(this._paginationNode,l.selector("li","keyup"),function(b){a._keyupFeature(b,this)}),l(this._actionsNode,l.selector("[data-action-index]",s),function(){a._actionEvent(this)}),l(b,"trigger-action",function(a){a.action&&"zoom-to"===a.action.id&&this.viewModel.zoomToLocation()}.bind(this)));f.setUpEventDelegates(this,"trigger-action")},destroy:function(){this._destroyPopupRendererVMs();this._destroyMessage();
this._destroySpinner();this._destroyPopupRenderer();this._handleRegistry.destroy();this._handleRegistry=null},_getActionsAttr:f.createGetterDelegate("actions"),_setActionsAttr:f.createSetterDelegate("actions"),alignment:"top",_setAlignmentAttr:function(a){this._set("alignment",a);this.reposition()},autoPanEnabled:!0,_getContentAttr:f.createGetterDelegate("content"),_setContentAttr:f.createSetterDelegate("content"),closeOnViewChangeEnabled:!1,dockOptions:D,_setDockOptionsAttr:function(a){var b=v.clone(D),
d=this.viewModel.get("view.breakpoints"),p={};d&&(p.width=d.xsmall,p.height=d.xsmall);a=v.mixin({},b,a);b=v.mixin({},b.breakpoint,p);!0===a.breakpoint?a.breakpoint=b:"object"===typeof a.breakpoint&&(a.breakpoint=v.mixin({},b,a.breakpoint));this._set("dockOptions",a);this._toggleDockButton(a)},dockEnabled:!1,_setDockEnabledAttr:function(a){this._set("dockEnabled",a);this._togglePopupDocking(a);this._togglePopupLocationRepositioning(this.visible);this.reposition()},currentDockPosition:null,_getFeatureCountAttr:f.createGetterDelegate("featureCount"),
_setFeatureCountAttr:f.createSetterDelegate("featureCount"),_getFeaturesAttr:f.createGetterDelegate("features"),_setFeaturesAttr:f.createSetterDelegate("features"),_getLocationAttr:f.createGetterDelegate("location"),_setLocationAttr:f.createSetterDelegate("location"),messageEnabled:!0,_setMessageEnabledAttr:function(a){this._set("messageEnabled",a);this._createMessage(a,this.viewModel.view)},paginationEnabled:!0,_setPaginationEnabledAttr:function(a){var b=this.viewModel;this._set("paginationEnabled",
a);this._updatePagination(b.features,b.selectedFeatureIndex);this._updateFooterVisibility(b.features,b.actions);this.reposition()},_getPromisesAttr:f.createGetterDelegate("promises"),_setPromisesAttr:f.createSetterDelegate("promises"),_getSelectedFeatureAttr:f.createGetterDelegate("selectedFeature"),_setSelectedFeatureAttr:f.createSetterDelegate("selectedFeature"),_getSelectedFeatureIndexAttr:f.createGetterDelegate("selectedFeatureIndex"),_setSelectedFeatureIndexAttr:f.createSetterDelegate("selectedFeatureIndex"),
spinnerEnabled:!0,_setSpinnerEnabledAttr:function(a){this._set("spinnerEnabled",a);this._createSpinner(a,this.viewModel.view)},_getTitleAttr:f.createGetterDelegate("title"),_setTitleAttr:f.createSetterDelegate("title"),_getViewAttr:f.createGetterDelegate("view"),_setViewAttr:f.createSetterDelegate("view"),visible:!1,_setVisibleAttr:function(a){this._set("visible",a);e.remove(this._containerNode,c.menuOpen);e.toggle(this.domNode,c.invisible,!a);this._togglePopupLocationRepositioning(a);this._toggleContentVisibility(a);
this.reposition()},_css:c,_i18n:A,_hideActionsTextNum:3,_animationDelay:10,_popupRendererVMs:[],clear:f.createMethodDelegate("clear"),close:function(){this.set("visible",!1)},next:f.createMethodDelegate("next"),previous:f.createMethodDelegate("previous"),reposition:function(){this._positionPopup();return this._moveIntoView()},open:function(a){a=v.mixin({updateLocationEnabled:!1},a);this.viewModel.set(a);this.set("visible",!0)},triggerAction:f.createMethodDelegate("triggerAction"),_actionChangeListener:function(a){this._handleRegistry.remove(r.actionsChange);
a&&this._handleRegistry.add([a.on("change",function(){var a=this.viewModel;this._updateActions(a.actions,a.features)}.bind(this))],r.actionsChange)},_actionEvent:function(a){var b=this.viewModel;if(a=h.get(a,"data-action-index"))a=parseInt(a,10),b.triggerAction(a)},_addContent:function(){var a=this.viewModel;this._updateSelectedFeature(a.selectedFeature);this._updateContent(a.content);this._updateTitle(a.title);this._updatePageText(a.features,a.selectedFeatureIndex)},_updateActions:function(a,b){this._updateActionButtons(a);
this._updateFooterVisibility(b,a);this.reposition()},_updateActionButtons:function(a){this._handleRegistry.remove(r.actions);if(this._actionsNode){var b=document.createDocumentFragment(),d=a.length;d&&a.forEach(function(a,m){"zoom-to"===a.id&&(a.title=this._i18n.zoom,a.className=c.zoomIcon);var g=q.create("div",{tabindex:"0",title:a.title},b);h.set(g,"data-action-index",m);e.add(g,[c.btn,c.action]);var u=q.create("span",{"aria-hidden":!0},g);e.add(u,c.icon);a.className&&e.add(u,a.className);a.image&&
(e.add(u,c.actionImage),x.set(u,"background-image","url("+a.image+")"));var k={className:c.actionText,textContent:a.title};d>=this._hideActionsTextNum&&(k.className=c.iconText);var f=q.create("span",k,g);this._handleRegistry.add([n.init(a,"visible",function(a){e.toggle(g,c.hidden,!a)}),n.init(a,"className",function(a,b){e.remove(u,b);e.add(u,a)}),n.init(a,"image",function(a){e.toggle(u,c.actionImage,!!a);x.set(u,"background-image",a?"url("+a+")":"")}),n.init(a,"title",function(a){a=a||"";h.set(g,
"title",a);h.set(f,"textContent",a)})],r.actions)},this);q.place(b,this._actionsNode,"only")}},_getLocationScreenPoint:function(){var a=this.viewModel,b;if(a.location&&this.visible){var d=a.location;d&&a.get("view.ready")&&(b=a.view.toScreen(d))}return b},_calculatePosition:function(a,b){var d,c,m,g,e,k;if(a&&b){m=b.pointer.h;g=b.pointer.w;d=b.popup.h;if("top"===b.alignment||"bottom"===b.alignment)d+=m;c=b.popup.w;if("left"===b.alignment||"right"===b.alignment)c+=g;switch(b.alignment){case "bottom":m=
a.y+m;g=a.x-c/2;e=a.y+d;k=g+c;break;case "left":m=a.y-d/2;g=a.x-c;e=m+d;k=g+c;break;case "right":m=a.y-d/2;g=a.x+g;e=m+d;k=a.x+c;break;default:m=a.y-d,g=a.x-c/2,e=m+d,k=g+c}return{height:d,width:c,top:m,left:g,bottom:e,right:k}}},_createPopupRendererVMs:function(a){this._destroyPopupRendererVMs();a&&1<a.length&&a.forEach(function(a,d){var c=new L({contentEnabled:!1,graphic:a});this._popupRendererVMs.push(c)},this)},_destroyPopupRendererVMs:function(){this._handleRegistry.remove(r.paginationTitles);
this._popupRendererVMs.forEach(function(a){a.destroy()});this._popupRendererVMs.length=0},_createPaginationNodes:function(a,b){this._handleRegistry.remove(r.paginationTitles);if(a){var d=a.length;this._paginationNode&&h.set(this._paginationNode,"innerHTML","");1<d&&(d=B.substitute({total:d},this._i18n.selectedFeatures),h.set(this._pageMenuInfoNode,"textContent",d),a.forEach(function(a,d){var g=this._i18n.untitled,f=q.create("li",{role:"menu-item",className:c.pageMenuItem},this._paginationNode);d===
b?(h.set(f,"aria-label",A.selectedFeature),e.add(f,c.pageMenuSelected)):h.set(f,"data-feature-index",d);var k=q.create("span",{className:c.pageMenuTitle,innerHTML:g},f);if(g=this._popupRendererVMs[d])g=n.init(g,"title",function(a){h.set(k,"innerHTML",a)}),this._handleRegistry.add(g,r.paginationTitles);d===b&&q.create("span",{className:c.pageMenuCheckMark},k)},this))}},_createMessage:function(a,b){this._destroyMessage();a&&b&&(this._message=new N({visible:!1,text:this._i18n.noFeaturesFound,viewModel:{view:b}}),
this._message.startup(),q.place(this._message.domNode,b.root))},_createSpinner:function(a,b){this._destroySpinner();a&&b&&(this._spinner=new M({visible:!1,viewModel:{view:b}}),this._spinner.startup(),q.place(this._spinner.domNode,b.root))},_updateContent:function(a){a&&a.nodeName?(q.place(a,this._contentStorage),q.place(a,this._bodyContentNode,"only")):"string"===typeof a&&(this._destroyPopupRenderer(),h.set(this._bodyContentNode,"innerHTML",a));this._bodyContentNode.scrollTop=0;e.toggle(this._containerNode,
c.hasPopupRenderer,!!(this._popupRenderer&&this._popupRenderer.viewModel.content===a));e.toggle(this._containerNode,c.showContent,!!a);e.remove(this._containerNode,c.menuOpen)},_destroyPopupRenderer:function(){this._popupRenderer&&!this._popupRenderer._destroyed&&(this._handleRegistry.remove(r.popupRenderer),this._popupRenderer.destroy(),this._popupRenderer=null)},_destroyMessage:function(){this._message&&(this._message.destroyRendering(),this._message.destroy(),this._message=null)},_destroySpinner:function(){this._spinner&&
(this._spinner.destroyRendering(),this._spinner.destroy(),this._spinner=null)},_setDockEnabledForViewSize:function(a){a.breakpoint&&this.set("dockEnabled",this._shouldDockAtCurrentViewSize(a))},_togglePopupDocking:function(a){e.remove(this._containerNode,c.menuOpen);e.toggle(this._containerNode,c.docked,!!a);h.set(this._dockNode,"title",a?this._i18n.undock:this._i18n.dock);this._updateDockPosition(this.dockOptions)},_dockingThresholdCrossed:function(a,b,d){var c=a[0];a=a[1];var m=b[0];b=b[1];var e=
d.width;d=d.height;return c<=e&&m>e||c>e&&m<=e||a<=d&&b>d||a>d&&b<=d},_determineDockPosition:function(a){var b=this.viewModel,d=b.view,c=d&&d.padding,c=d&&d.width-c.left-c.right;return(b=d&&b.get("view.breakpoints"))&&c<=b.xsmall?a.bottomCenter:!this.isLeftToRight()?a.topLeft:a.topRight},_updateDockPosition:function(a){e.remove(this._containerNode,[c.dockedTopLeft,c.dockedTopCenter,c.dockedTopRight,c.dockedBottomLeft,c.dockedBottomCenter,c.dockedBottomRight,c.dockToTop,c.dockToBottom,c.dockToLeft,
c.dockToRight]);var b,d,p;b=a.position;b=b===t.auto?this._determineDockPosition(t):b;switch(b){case t.topLeft:d=c.dockedTopLeft;p=c.dockToLeft;break;case t.topCenter:d=c.dockedTopCenter;p=c.dockToTop;break;case t.bottomLeft:d=c.dockedBottomLeft;p=c.dockToLeft;break;case t.bottomCenter:d=c.dockedBottomCenter;p=c.dockToBottom;break;case t.bottomRight:d=c.dockedBottomRight;p=c.dockToRight;break;default:d=c.dockedTopRight,p=c.dockToRight}e.toggle(this._containerNode,p,!!a.buttonEnabled);this.dockEnabled?
(e.add(this._containerNode,d),this._set("currentDockPosition",b)):this._set("currentDockPosition",null);this._popupRenderer&&this._popupRenderer.resize();this.reposition()},_toggleDockButton:function(a){var b=this._containerNode;e.toggle(b,c.showDock,!!a.buttonEnabled);e.toggle(b,c.docked,!!this.dockEnabled);this._updateDockPosition(a)},_updateFooterVisibility:function(a,b){var d=this._isPaginationEnabled(a)||b&&b.length;e.toggle(this._containerNode,c.showFooter,!!d)},_isPaginationEnabled:function(a){return this.paginationEnabled&&
a&&1<a.length},_updatePagination:function(a,b){this._updatePageText(a,b);this._createPaginationNodes(a,b);e.toggle(this._containerNode,c.showPagination,this._isPaginationEnabled(a))},_displayPendingFeaturesStatus:function(a,b,d,p){var m=0<a&&0===b;a&&(d.length&&a===d.length)&&this.set("visible",!1);e.toggle(this._containerNode,c.pendingPromises,!!a);e.toggle(this._containerNode,c.pendingPromisesResult,!!m);e.toggle(this._containerNode,c.hasPromiseFeatures,!!b);this._message&&this._message.set({visible:!1});
m?this._spinner&&(this._spinner.set({visible:!0}),this._spinner.viewModel.point=p):(this._spinner&&(this._spinner.viewModel.point=null),b&&!this.visible&&this.set("visible",!0),!b&&(d&&d.length)&&this._message&&(this._message.set({visible:!0}),this._message.viewModel.point=p))},_moveIntoView:function(){var a=new I;setTimeout(a.resolve.bind(this),this._animationDelay);return a.then(function(){if(!this._destroyed){var a=this.viewModel,d=this.get("viewModel.view");if(a&&d&&d.stationary){var c=this._getLocationScreenPoint();
if(c){var e=this._sizePopup(),e=this._calculatePosition(c,e),g=d.width,f=d.height,k=d.padding,h=d.ui.padding;if(this.autoPanEnabled){if(c.y<k.top||c.y>f-k.bottom||c.x<k.left||c.x>g-k.right)return a.centerAtLocation();if(!this.dockEnabled&&e&&e.width<d.width&&e.height<d.height){var l=c=0;e.top<k.top?l=-e.top+h.top+k.top:e.bottom>f-k.bottom&&(l=-(e.bottom-f+k.bottom)-h.bottom);e.left<k.left?c=e.left-h.left-k.left:e.right>g-k.right&&(c=e.right-g+k.right+h.right);if(c||l)return e=y.translateBy(y.create(),
d.viewpoint,[c,l]),d.goTo(e,a.animationOptions)}}}}}}.bind(this))},_positionPopup:function(){var a=this.viewModel.view;if(a){e.remove(this._containerNode,[c.top,c.bottom,c.left,c.right]);var b;switch(this.alignment){case "bottom":b=c.bottom;break;case "right":b=c.right;break;case "left":b=c.left;break;default:b=c.top}e.add(this._containerNode,b);b=this._getLocationScreenPoint();var d=this._sizePopup();if(b=this._calculatePosition(b,d))a=a.padding,x.set(this._containerNode,this.dockEnabled?{left:a.left?
a.left+"px":"",top:a.top?a.top+"px":"",right:a.right?a.right+"px":"",bottom:a.bottom?a.bottom+"px":""}:{left:b.left+"px",top:b.top+"px",right:"",bottom:""})}},_removeContent:function(){this._destroyPopupRenderer();h.set(this._bodyContentNode,"innerHTML","");h.set(this._titleNode,"innerHTML","");h.set(this._pageTextNode,"innerHTML","");h.set(this._pageTextDockedNode,"innerHTML","");e.remove(this._containerNode,[c.showTitle,c.showContent])},_keyupFeature:function(a,b){var d=a.keyCode;if(d===w.UP_ARROW||
d===w.DOWN_ARROW){a.stopPropagation();a.preventDefault();var c=z("li",this._paginationNode),e=c.length,g=c.indexOf(b),f;d===w.UP_ARROW?f=g-1:d===w.DOWN_ARROW&&(f=g+1);0>f?f=e-1:f>=e&&(f=0);c[f].focus()}},_selectFeature:function(a){var b=this.viewModel,d=-1;(a=h.get(a,"data-feature-index"))&&(d=parseInt(a,10));-1!==d&&(b.selectedFeatureIndex=d);e.remove(this._containerNode,c.menuOpen);this._pageMenuNode.focus()},_updateSelectedFeature:function(a){var b=this.viewModel,c,e="",f="";if(a){if(c=a.layer)e=
c.id||"",f=c.name||"";if(!this._popupRenderer||this._popupRenderer&&this._popupRenderer._destroyed){this._handleRegistry.remove(r.popupRenderer);this._popupRenderer=new K;c=this._popupRenderer.viewModel.watch("title",function(a){b.title=a});var g=this._popupRenderer.viewModel.watch("content",function(a){b.content=a?this._popupRenderer.domNode:null}.bind(this)),n=l(this._popupRenderer,"resize",this.reposition.bind(this));this._handleRegistry.add([c,g,n],r.popupRenderer);this._popupRenderer.startup()}this._popupRenderer.viewModel.graphic=
a}this._toggleFeatureUpdatedClass();h.set(this._containerNode,"data-layer-name",f);h.set(this._containerNode,"data-layer-id",e);this.reposition()},_updateFeatures:function(a){var b=this.viewModel;this._createPopupRendererVMs(a);this._updatePagination(a,b.selectedFeatureIndex);this._updateFooterVisibility(a,b.actions);this.reposition()},_shouldDockAtCurrentViewSize:function(a){var b=this.viewModel;a=a.breakpoint;return b.view&&(a.hasOwnProperty("width")&&b.view.ui.width<=a.width||a.hasOwnProperty("height")&&
b.view.ui.height<=a.height)},_sizePopup:function(){var a=C.getContentBox(this._containerNode),b=C.getContentBox(this._pointerNode);return{alignment:this.alignment,popup:a,pointer:b}},_updateTitle:function(a){a=a||"";h.set(this._titleNode,"innerHTML",a);e.toggle(this._containerNode,c.showTitle,!!a);e.remove(this._containerNode,c.menuOpen)},_toggleDock:function(){this.set("dockEnabled",!this.dockEnabled)},_togglePageMenu:function(){e.toggle(this._containerNode,c.menuOpen);var a=e.contains(this._containerNode,
c.menuOpen);h.set(this._pageMenuSectionNode,"aria-hidden",!a);var b=z("li",this._paginationNode),d=b[0];b.forEach(function(b){h.set(b,"tabIndex",a?"0":"")});a?d&&d.focus():this._pageMenuNode.focus()},_updatePageText:function(a,b){var c="";this._isPaginationEnabled(a)&&(c=B.substitute({index:b+1,total:a.length},this._i18n.pageText));this._pageTextNode&&h.set(this._pageTextNode,{textContent:c});this._pageTextDockedNode&&h.set(this._pageTextDockedNode,{textContent:c})},_toggleFeatureUpdatedClass:function(){e.remove(this._containerNode,
c.featureUpdated);this._containerNode.offsetWidth=this._containerNode.offsetWidth;e.add(this._containerNode,c.featureUpdated)},_viewPointChanged:function(){this.closeOnViewChangeEnabled?this.close():this._positionPopup()},_wireUpView:function(a){this._handleRegistry.remove(r.view);this._viewPointEvent=null;if(a){var b="viewpoint";"3d"===a.type&&(b="camera");this._viewPointEvent=n.pausable(a,b,this._viewPointChanged.bind(this));this._handleRegistry.add([a.watch("padding",this.reposition.bind(this)),
a.watch("size",this._updateDockEnabledForViewSize.bind(this)),l(a,"resize",this.reposition.bind(this)),this._viewPointEvent],r.view);this._togglePopupLocationRepositioning(this.visible);this._createMessage(this.messageEnabled,a);this._createSpinner(this.spinnerEnabled,a);this._setDockEnabledForViewSize(this.dockOptions);this._toggleDockButton(this.dockOptions);this.reposition()}},_updateDockEnabledForViewSize:function(a,b){var c=this.get("viewModel.view.padding"),e=c.left+c.right,f=c.top+c.bottom,
c=[],g=[];c[0]=a[0]-e;c[1]=a[1]-f;g[0]=b[0]-e;g[1]=b[1]-f;e=this.dockOptions;this._dockingThresholdCrossed(c,g,e.breakpoint)&&this._setDockEnabledForViewSize(e);this._updateDockPosition(e)},_togglePopupLocationRepositioning:function(a){var b=this.viewModel;this._viewPointEvent&&(a&&b.location&&!this.dockEnabled?this._viewPointEvent.resume():this._viewPointEvent.pause())},_toggleContentVisibility:function(a){a?this._addContent():this._removeContent()}})});