// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.0/esri/copyright.txt for details.
//>>built
define(["../../../core/numberUtils"],function(n){var z=[255,255,255],q=[128,128,128];return{_getRampStops:function(c,b,a,e){var d=b.legendOptions,d=d&&d.customValues,h,k,g;g=this._getSizeSymbol(c,a);var f=null!=b.minSize&&null!=b.maxSize;a=b.stops&&1<b.stops.length;var p=!!b.target;if(!(b.valueUnit&&"unknown"!==b.valueUnit||!g||!d&&!(f||a&&!p))){d=d||this._getSizeDataValues(c,b,g,e);!d&&a&&(d=b.stops.map(function(a){return a.value}),(h=b.stops.some(function(a){return!!a.label}))&&(k=b.stops.map(function(a){return a.label})));
var l=d.length-1,d=d.map(function(a,d){var f=this._getSizeAppliedCloneSymbol(c,b,g,a,e),m=n.format(a);d===l?m="\x3e "+m:0===d&&(m="\x3c "+m);m=h?k[d]:m;return{value:a,symbol:f,label:m}},this);return d.reverse()}},_getSizeSymbol:function(c,b){var a,e;if("simple"===c.type)a=c.symbol;else if("uniqueValue"===c.type||"classBreaks"===c.type)a=(a=(e=c.classBreakInfos||c.uniqueValueInfos)&&e[0])&&a.symbol,e=1<e.length;if(a=a&&-1!==a.type.indexOf("fill-symbol")?null:a)if(a=a.clone(),b||e)-1!==a.type.indexOf("line-symbol")?
a.color=q:(a.color=z,"simple-marker-symbol"===a.type&&(a.outline={color:q,width:1.5}));return a},_getSizeDataValues:function(c,b,a,e){var d=c.getSizeRangeAtScale(b,e),h=d&&this._interpolateSizeRange(d),k;if(d||h){k=h.map(function(a){return this._getDataValueFromSize(a,b,d)},this);k=n.round(k);for(var g=1;g<k.length-1;g++){var f=this._roundDataValue(c,b,a,k[g],k[g-1],e);f&&(k[g]=f[0],h[g]=f[1])}return k}},_interpolateSizeRange:function(c){var b=c.minSize;c=(c.maxSize-b)/4;for(var a=[],e=0;5>e;e++)a.push(b+
c*e);return a},_getDataValueFromSize:function(c,b,a){var e=a.minSize;a=a.maxSize;var d=b.minDataValue;b=b.maxDataValue;return c=c<=e?d:c>=a?b:(c-e)/(a-e)*(b-d)+d},_roundDataValue:function(c,b,a,e,d,h){var k=this._getSize(c,b,a,e,h);d=this._getSize(c,b,a,d,h);var g,f=n.getDigits(e),p=f.integer,f=f.fractional,l,r,v,w,m,x,y,q,s,t,u;0<e&&1>e&&(g=Math.pow(10,f),e*=g,p=n.getDigits(e).integer);for(p-=1;0<=p&&!(l=Math.pow(10,p),f=Math.floor(e/l)*l,l*=Math.ceil(e/l),null!=g&&(f/=g,l/=g),r=(f+l)/2,r=n.round([f,
r,l],{indexes:[1]})[1],v=this._getSize(c,b,a,f,h),w=this._getSize(c,b,a,l,h),m=this._getSize(c,b,a,r,h),x=n.getPctChange(k,v,d,null),y=n.getPctChange(k,w,d,null),q=n.getPctChange(k,m,d,null),s=20>=x.prev,t=20>=y.prev,s&&t&&(x.prev<=y.prev?(s=!0,t=!1):(t=!0,s=!1)),s?u=[f,v]:t?u=[l,w]:20>=q.prev&&(u=[r,m]),u);p--);return u},_getSizeAppliedCloneSymbol:function(c,b,a,e,d){a=a.clone();var h=a.type;c=this._getSize(c,b,a,e,d);switch(h){case "simple-marker-symbol":a.size=c;break;case "picture-marker-symbol":h=
a.width;b=a.height;a.height=c;a.width=c*(h/b);break;case "simple-line-symbol":case "cartographic-line-symbol":a.width=c;break;case "text-symbol":a.font&&(a.font.size=c)}return a},_getSize:function(c,b,a,e,d){return c.getSize(e,{sizeInfo:b,scale:d,shape:-1!==a.type.indexOf("marker-symbol")?a.style:null})}}});