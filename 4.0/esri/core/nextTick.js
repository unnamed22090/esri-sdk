// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.0/esri/copyright.txt for details.
//>>built
define(["dojo/_base/window","./ObjectPool"],function(n,e){var a=n.global,k=a.MutationObserver||a.WebKitMutationObserver,l=new e(function(){this.isActive=!0;this.callback=null},function(){this.isActive=!1;this.callback=null}),p=function(){},q=function(){m.release(this)},m=new e(function(){this.remove=q},function(){this.remove=p;this.destructor&&this.destructor();this.item.isActive=!1;this.destructor=this.item=null}),r=function(a,d){var f=m.acquire();f.item=a;f.destructor=d;return f},h=function(a){a.isActive&&
(a.isActive=!1,a.callback());a.isActive||l.release(a)};return function(){var g,d,f=function(){if(a.postMessage&&!a.importScripts){var b=!0,d=a.onmessage;a.onmessage=function(){b=!1};a.postMessage("","*");a.onmessage=d;return b}},c=[];if(k){var e=document.createElement("div");(new k(function(){for(;0<c.length;){var a=c.shift();h(a)}})).observe(e,{attributes:!0});d=function(a){c.push(a);e.setAttribute("queueStatus","1")}}else f()?(a.addEventListener("message",function(b){if(b.source==a&&"esri-nexttick-message"==
b.data)for(b.stopPropagation();c.length;)h(c.shift())},!0),d=function(b){c.push(b);a.postMessage("esri-nexttick-message","*")}):a.setImmediate?(g=a.clearImmediate,d=function(b){return a.setImmediate(h.bind(null,b))}):(g=a.clearTimeout,d=function(b){return a.setTimeout(h.bind(null,b),0)});return function(a){var c=l.acquire();c.callback=a;var e=d(c);return r(c,g&&function(){g(e)})}}()});