// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.0/esri/copyright.txt for details.
//>>built
define(["./core/Collection","./core/HandleRegistry","./core/Scheduler","./core/watchUtils"],function(d,e,f,k){var g=function(a){var c=function(b){b&&(a.push(b),b.forEach(function(a){c(a.layers)}));return a};return c},h=function(a){var c=function(b){b&&b.forEach(function(b){a.push(b);c(b.layers)});return a};return c};return d.createSubclass({declaredClass:"esri.AllLayersCollection",properties:{source:{}},constructor:function(){this._handles=new e;this._repopulate=this._repopulate.bind(this);this.refresh=
this.refresh.bind(this)},initialize:function(){this._handles.add(this.layersCollectionNames.map(function(a){return this.watch(a,this.refresh)},this));this._repopulate()},destroy:function(){this.source=null;this._repopulate();this._handles.destroy();this._handles=null},_handles:null,layersCollectionNames:["source.basemap.baseLayers","source.ground.layers","source.layers","source.basemap.referenceLayers"],source:null,refresh:function(){var a=this._handles;a&&(a.remove("refresh"),a.add(f.schedule(this._repopulate),
"refresh"))},_repopulate:function(){var a=this._handles;a.remove("refresh");a.remove("collections");var c=this.layersCollectionNames.map(this.get,this).filter(function(a){return null!=a}),b=[];c.forEach(g(b));a.remove("collections");a.add(b.map(function(a){return a.on("change",this.refresh)},this),"collections");this.removeAll();c.forEach(h(this))},_createNewInstance:function(a){return new d(a)}})});