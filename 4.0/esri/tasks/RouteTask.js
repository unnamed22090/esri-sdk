// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.0/esri/copyright.txt for details.
//>>built
define("../core/declare ../geometry/support/normalizeUtils ../Graphic ../request ./support/NAMessage ./support/RouteResult ./Task ./support/NAServiceDescription dojo/Deferred dojo/_base/array dojo/_base/lang".split(" "),function(e,l,v,w,x,y,z,A,k,m,h){e=e([z,A],{declaredClass:"esri.tasks.RouteTask",__msigns:[{n:"solve",c:1,a:[{i:0,p:["stops.features","barriers.features","polylineBarriers.features","polygonBarriers.features"]}],e:2}],_parsedUrlGetter:function(p){var b=this.inherited(arguments);b.path+=
"/solve";return b},url:null,solve:function(p,b){var c=new k,a=new k,e=this.__msigns[0].a[0].p,f=b&&b.assembly&&b.assembly[0]||{};this._isInputGeometryZAware(f,e)?a=this.getServiceDescription():a.resolve({dontCheck:!0});a.then(h.hitch(this,function(a){!a.HasZ&&!a.dontCheck&&this._dropZValuesOffInputGeometry(f,e);a=this._encode(h.mixin({},this.parsedUrl.query,{f:"json"},p.toJSON(f)));w(this.parsedUrl.path,{query:a,callbackParamName:"callback"}).then(h.hitch(this,function(a){c.resolve(this._handleSolveResponse(a))}),
c.reject)},c.reject));return c.promise},_handleSolveResponse:function(e){var b=[],c=[],a=e.data,h=a.routes?a.routes.features:[],f=a.stops?a.stops.features:[];e=a.barriers?a.barriers.features:[];var k=a.polygonBarriers?a.polygonBarriers.features:[],l=a.polylineBarriers?a.polylineBarriers.features:[],n=a.messages,g=m.forEach,q=m.indexOf,r=!0,d,s,t=a.routes&&a.routes.spatialReference||a.stops&&a.stops.spatialReference||a.barriers&&a.barriers.spatialReference||a.polygonBarriers&&a.polygonBarriers.spatialReference||
a.polylineBarriers&&a.polylineBarriers.spatialReference;g(a.directions||[],function(a){b.push(d=a.routeName);c[d]={directions:a}});g(h,function(a){if(-1===q(b,d=a.attributes.Name))b.push(d),c[d]={};c[d].route=a});g(f,function(a){s=a.attributes;if(-1===q(b,d=s.RouteName||"esri.tasks.RouteTask.NULL_ROUTE_NAME"))b.push(d),c[d]={};"esri.tasks.RouteTask.NULL_ROUTE_NAME"!==d&&(r=!1);void 0===c[d].stops&&(c[d].stops=[]);c[d].stops.push(a)});0<f.length&&!0===r&&(c[b[0]].stops=c["esri.tasks.RouteTask.NULL_ROUTE_NAME"].stops,
delete c["esri.tasks.RouteTask.NULL_ROUTE_NAME"],b.splice(m.indexOf(b,"esri.tasks.RouteTask.NULL_ROUTE_NAME"),1));var u=[];g(b,function(a,b){c[a].routeName="esri.tasks.RouteTask.NULL_ROUTE_NAME"===a?null:a;c[a].spatialReference=t;u.push(y.fromJSON(c[a]))});a=function(a){g(a,function(b,c){b.geometry&&(b.geometry.spatialReference=t);a[c]=v.fromJSON(b)});return a};g(n,function(a,b){n[b]=x.fromJSON(a)});return{routeResults:u,barriers:a(e),polygonBarriers:a(k),polylineBarriers:a(l),messages:n}}});l._createWrappers(e);
return e});