// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.0/esri/copyright.txt for details.
//>>built
define("require exports ../../core/tsSupport/extendsHelper ../../core/tsSupport/decorateHelper ../../core/accessoireSupport/typescript dojo/_base/lang dojo/has ../../core/Accessoire ../../core/promiseUtils ../../PopupTemplate ../../layers/support/LabelClass ../../renderers/support/jsonUtils ../../core/urlUtils ../../renderers/support/layerTemplates".split(" "),function(t,u,m,f,e,n,v,p,g,q,r,h,s,k){return function(l){function d(a){l.call(this)}m(d,l);d.prototype.create=function(){var a=this,d=this.type;
return this.layerProperties(this.layer).then(function(b){a.layer.itemId&&(b.portalItem={id:a.layer.itemId,portal:a.portal});return g.resolve(new d(b))})};d.prototype.layerProperties=function(a){var d=this,b={};null!=a.title&&(b.title=a.title);void 0!==a.url&&(b.url=s.normalize(a.url));var c=function(a){return a},f=n.clone,e=function(a,b,c){for(var d in c){var e=b[d];void 0!==e&&(a[d]=c[d](e))}return a};e(b,a,{id:c,opacity:c,minScale:c,maxScale:c,listMode:c});var g=a.layerDefinition;void 0!==g&&(e(b,
g,{minScale:c,maxScale:c,elevationInfo:f,definitionExpression:c}),c=a.layerDefinition.drawingInfo,void 0!==c&&(c=c.labelingInfo,void 0!==c&&(Array.isArray(c)&&0<c.length)&&(b.labelingInfo=c.map(function(a){return r.fromJSON(a)}))));void 0!==a.showLabels&&(b.labelsVisible=a.showLabels);void 0!==a.visibility&&(b.visible=!!a.visibility);void 0!==a.disablePopup&&(b.popupEnabled=!a.disablePopup);void 0!==a.popupInfo&&(b.popupTemplate=q.fromJSON(a.popupInfo));void 0!==a.showLegend&&(b.legendEnabled=a.showLegend);
return this.createRenderer(a,b).then(function(c){c&&(b.renderer=c);d.propertyFilter&&(c=d.propertyFilter(a,b),void 0!==c&&(b=c));return b}).otherwise(function(a){return b})};d.prototype.createRenderer=function(a,d){if(!a.layerDefinition||!a.layerDefinition.drawingInfo||!a.layerDefinition.drawingInfo.renderer)return g.resolve(null);var b=a.layerDefinition.drawingInfo.renderer;return k.hasContentByReference(b)?k.createRenderer(b,this.portal).then(function(a){d.legendEnabled=!1;return a}).otherwise(function(a){return h.fromJSON(b)}):
g.resolve(h.fromJSON(b))};f([e.shared("esri.portal.creators.LayerCreator")],d.prototype,"declaredClass",void 0);f([e.shared(null)],d.prototype,"type",void 0);f([e.property()],d.prototype,"layer",void 0);f([e.property()],d.prototype,"portal",void 0);f([e.property()],d.prototype,"propertyFilter",void 0);return d=f([e.subclass()],d)}(p)});