// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.0/esri/copyright.txt for details.
//>>built
define("require exports ../../layers/Layer ../../core/promiseUtils ../../core/requireUtils dojo/_base/lang dojo/has".split(" "),function(r,f,s,g,t,u,x){function v(c,b,a){return t.when(r,"./"+b).then(function(b){return(new b(u.mixin(a,{layer:c}))).create()})}function l(c,b){var a=null,a=c.layerType||c.type;!a&&(b&&b.defaultLayerType)&&(a=b.defaultLayerType);switch(a){case "ArcGISFeatureLayer":a="FeatureLayerCreator";break;case "ArcGISImageServiceLayer":a="ImageServiceLayerCreator";break;case "ArcGISMapServiceLayer":a=
"MapServiceLayerCreator";break;case "ArcGISSceneServiceLayer":a="SceneServiceLayerCreator";break;case "ArcGISStreamLayer":a="StreamLayerCreator";break;case "ArcGISTiledMapServiceLayer":a="TiledMapServiceLayerCreator";break;case "ArcGISTiledImageServiceLayer":a="TiledImageServiceLayerCreator";break;case "ArcGISTiledElevationServiceLayer":a="TiledElevationServiceLayerCreator";break;case "GroupLayer":a="GroupLayerCreator";break;case "OpenStreetMap":a="OpenStreetMapCreator";break;case "WebTiledLayer":a=
"WebTileLayerCreator";break;case "VectorTileLayer":a="VectorTileLayerCreator";break;case "DefaultTiledLayer":a="TiledServiceLayerCreator";break;case "ArcGISImageServiceVectorLayer":case "CSV":case "KML":case "WMS":case "GeoRSS":a="UnsupportedLayerCreator";break;default:a="UnknownLayerCreator"}return v(c,a,b)}function n(c,b,a){return!b||!b.filter?a:a.then(function(a){var c=b.filter(a);return void 0===c?g.resolve(a):c instanceof s?g.resolve(c):c})}function e(c,b,a,f){if(!b)return[];for(var h=[],k=[],
m=0;m<b.length;m++){var d=b[m],e=a(d,f);h.push(e);k.push(null);if("GroupLayer"===d.layerType&&d.layers&&Array.isArray(d.layers)&&0<d.layers.length){d=d.layers.map(function(a){return l(a,f)});h.push.apply(h,d);for(var p=0;p<d.length;p++)k.push(e)}}var q={};return h.map(function(a,b){var d=function(a,c){q[c.id]=b;var d=a.findIndex(function(a){if(!a.id)return!1;a=q[a.id];return void 0===a?!1:b<a});0>d&&(d=void 0);a.add(c,d)},e=n(c,f,a).then(function(a){if(null===k[b])d(c,a);else return k[b].then(function(b){d(b.layers,
a);return g.resolve(a)});return g.resolve(a)});w&&(e=e.otherwise(function(a){console.error(a.toString?a.toString():a);return g.reject(a)}));return e})}var w=0;f.createLayer=l;f.processLayer=n;f.populateLayers=e;f.populateOperationalLayers=function(c,b,a){return e(c,b,l,a)}});