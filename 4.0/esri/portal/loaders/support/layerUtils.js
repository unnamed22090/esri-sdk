// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.0/esri/copyright.txt for details.
//>>built
define("require exports dojo/_base/lang ../../PortalItem ../../../core/promiseUtils ../../../core/requireUtils ../../../request ../../../core/Collection ../../../core/Error".split(" "),function(n,e,f,g,d,p,q,r,s){function h(a){return a.load().then(t).then(u)}function t(a){switch(a.type){case "Map Service":return v(a);case "Feature Service":return w(a);case "Feature Collection":return{className:"GroupLayer"};case "Scene Service":return x(a);case "Image Service":return y(a);case "Stream Service":return{className:"StreamLayer"};
case "Vector Tile Service":return{className:"VectorTileLayer"};default:return d.reject(new s("portal:unknown-item-type","Unknown item type '${type}'",{type:a.type}))}}function u(a){return p.when(n,"../../../layers/"+a.className).then(function(b){return{constructor:b,properties:a.properties}})}function v(a){return k(a).then(function(a){return a?{className:"TileLayer"}:{className:"MapImageLayer"}})}function w(a){return l(a).then(function(b){if(b){var c={returnZ:!0,outFields:["*"]};null!=b.id&&(c.url=
a.url+"/"+b.id);return{className:"FeatureLayer",properties:c}}return{className:"GroupLayer"}})}function x(a){return l(a).then(function(b){if(b){var c={};null!=b.id&&(c.url=a.url+"/layers/"+b.id);return{className:"SceneLayer",properties:c}}return{className:"GroupLayer"}})}function y(a){return k(a).then(function(b){var c=new r(a.typeKeywords);return b?c.find(function(a){return"elevation 3d layer"===a.toLowerCase()})?{className:"ElevationLayer"}:{className:"TileLayer"}:{className:"ImageryLayer"}})}function k(a){return m(a).then(function(a){return a.tileInfo})}
function l(a){return a.url.match(/\/\d+$/)?d.resolve({}):a.load().then(function(){return a.fetchData()}).then(function(b){return b&&Array.isArray(b.layers)?1===b.layers.length?{id:b.layers[0].id}:!1:m(a).then(function(a){return!a||!Array.isArray(a.layers)?{}:1===a.layers.length?{id:a.layers[0].id}:!1})})}function m(a){return q(a.url,{responseType:"json",callbackParamName:"callback",query:{f:"json"}}).then(function(a){return a.data})}e.layerFromPortalItem=function(a){if(a.portalItem&&!(a.portalItem instanceof
g)&&(!a.portalItem.constructor||!a.portalItem.constructor._meta))a=f.mixin({},a,{portalItem:new g(a.portalItem)});return h(a.portalItem).then(function(b){var c=f.mixin({portalItem:a.portalItem},b.properties);b=b.constructor;"esri.layers.FeatureLayer"===b.declaredClass&&(c.returnZ=!0,c.outFields=["*"]);return d.resolve(new b(c))})};e.layerClassFromPortalItem=h});