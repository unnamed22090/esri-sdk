// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.0/esri/copyright.txt for details.
//>>built
define("require exports ../../core/tsSupport/extendsHelper ../../core/tsSupport/decorateHelper ../../core/accessoireSupport/typescript ../../core/Accessoire ../../portal/PortalItem ../../core/Error ../../core/promiseUtils ./support/setUtils".split(" "),function(n,p,g,b,d,h,k,l,e,m){return function(f){function a(){f.apply(this,arguments)}g(a,f);a.prototype.load=function(){var a=this;return this.loadItem().then(function(c){return c&&a.validateItem()}).then(function(){return a.loadService()}).then(function(){return a.loadTitle()}).then(function(){return a.loadLayer()}).then(function(){return e.resolve(a.instance)})};
a.prototype.loadTitle=function(){this.portalItem.title&&!1!==this.instance.titleIncludesUrl&&m.setAsDefaultIfDefined(this.instance,"title",this.portalItem.title)};a.prototype.loadService=function(){if(this.loadFromService)return this.loadFromService()};a.prototype.loadItem=function(){var a=this;return!this.portalItem.id?e.resolve(null):this.portalItem.load().then(function(){return a.loadItemProperties()})};a.prototype.loadItemProperties=function(){var a=this;this.portalItem.url&&!this.instance.url&&
(this.instance.url=this.portalItem.url);return this.updateSublayerId().then(function(){return a.portalItem})};a.prototype.fetchData=function(a){void 0===a&&(a="json");return this.itemData?e.resolve(this.itemData):this.portalItem.fetchData(a)};a.prototype.validateItem=function(){if(-1===this.supportedItemTypes.indexOf(this.portalItem.type))throw new l("portal:invalid-layer-item-type","Invalid layer item type '${type}', expected '${expectedType}'",{type:this.portalItem.type,expectedType:this.supportedItemTypes.join(", ")});
};a.prototype.updateSublayerId=function(){var a=this.instance,c=a.url;if(c&&null==this.sublayerId){var b=c.lastIndexOf("/");-1!==b&&(c=parseInt(c.slice(b+1),10),isNaN(c)||(this.sublayerId=c,a.layerId=c))}return e.resolve(null)};b([d.shared("esri.portal.loaders.LayerLoader")],a.prototype,"declaredClass",void 0);b([d.shared(null)],a.prototype,"supportedItemTypes",void 0);b([d.property()],a.prototype,"instance",void 0);b([d.property({type:k})],a.prototype,"portalItem",void 0);b([d.property()],a.prototype,
"itemData",void 0);b([d.property()],a.prototype,"loadFromService",void 0);b([d.property()],a.prototype,"sublayerId",void 0);return a=b([d.subclass()],a)}(h)});