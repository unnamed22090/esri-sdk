// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.0/esri/copyright.txt for details.
//>>built
define(["../../../core/declare","dojo/keys","../../../core/sniff","../../inputs/Handler","../../2d/viewpointUtils"],function(k,f,h,l,g){return k(l,{declaredClass:"esri.views.2d.handlers.Navigation",constructor:function(){!1!==this.mouseRotate&&null!=this.mouseRotate&&(this.altdrag=this._altdrag)},_scrollAccum:0,_scrollTimeout:null,_lastPosition:null,_canZoom:!0,mouseRotate:h("mac")?f.META:f.CTRL,mouseZoomOut:f.SHIFT,mouseWheelZoom:!0,drag:function(a){var b=a.deltaX,d=a.deltaY,c=a.lastEvent,b=c?c.deltaX-
b:-b,d=c?d-c.deltaY:d,c=this.view,e=a.eventType;e==this._phaseDict.START&&(c.interacting=!0);e>=this._phaseDict.END?(c.interacting=!1,this._coords=this._lastPosition=null):(c.interacting||(c.interacting=!0),0===b&&0===d||(this._hasRotateKey(a.srcEvent)?this._altdrag(a):c.viewpoint=g.translateBy(this.viewpoint,c.viewpoint,[b||0,d||0])))},"double-click":function(a){var b=a.srcEvent.shiftKey?0.5:2,d=this.view;a=a.screenPoint;d.interacting=!1;d.goTo(this._scaleAndRotateViewpoint(a.x,a.y,b))},pinch:function(a){var b=
this.view,d=a.lastEvent,c=a.scale,e=a.rotation,f=a.eventType;if(!(1===c&&0===e)){a=a.screenPoint;var e=d?e-d.rotation:e,c=d?c/d.scale:c,d=Math.abs(1-c),g=Math.abs(e/90);f>=this._phaseDict.END?(b.interacting=!1,b.constraints._zoom.enabled=!0,b.goTo(b.viewpoint)):(!1===b.interacting&&(b.interacting=!0,b.constraints._zoom.enabled=!1),d>=g&&1!==c?b.viewpoint=this._scaleAndRotateViewpoint(a.x,a.y,c):g>d&&0!==e&&(b.viewpoint=this._scaleAndRotateViewpoint(a.x,a.y,c,e)))}},scroll:function(a){if(this.mouseWheelZoom){var b=
this.view,d=a.scrollDelta,c=a.screenPoint.x;a=a.screenPoint.y;if(!(0===d||-0===d)&&this._canZoom)this._canZoom=!1,b.interacting=!1,b.goTo(this._scaleAndRotateViewpoint(c,a,0>d?0.5:2)),this._scrollTimeout=setTimeout(function(){this._canZoom=!0}.bind(this),100)}},click:function(a){a.mapPoint=this.view.toMap(a.screenPoint)},hold:function(a){this.view.emit("hold",a)},altdrag:function(a){},_altdrag:function(a){var b=a.deltaX,d=a.deltaY,c=a.lastEvent,b=c?c.deltaX-b:-b,d=c?c.deltaY-d:d,c=this.view,e=0,e=
a.eventType;a=[a.screenPoint.x,a.screenPoint.y];e==this._phaseDict.START&&(c.interacting=!0);e>=this._phaseDict.END?(c.interacting=!1,this._coords=this._lastPosition=null):(c.interacting||(c.interacting=!0),0===b&&0===d||(e=g.angleBetween(c.state.paddedScreenCenter,this._lastPosition||a,a),c.viewpoint=g.rotateBy(this.viewpoint,c.content.viewpoint,e),b=this._lastPosition,this._lastPosition=a,this._coords=b))},_contextStop:function(a){a.preventDefault()},_scaleAndRotateViewpoint:function(a,b,d,c){var e=
this.view;a=[a,b];b=[];g.getPaddingScreenTranslation(b,e.size,e.padding);var f=e.animation?e.animation.target:e.viewpoint;a[0]+=b[0];a[1]+=b[1];return void 0==c?g.scaleBy(this.viewpoint,f,d,a,e.size):g.scaleAndRotateBy(this.viewpoint,f,d,c,a,e.content.size)},_hasRotateKey:function(a){var b=h("mac")?f.META:f.CTRL,d=!1;if(!1===b)return d;a.altKey&&b==f.ALT?d=!0:a.ctrlKey&&b==f.CTRL?d=!0:a.metaKey&&b==f.META?d=!0:a.shiftKey&&b==f.SHIFT&&(d=!0);return d}})});