// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.0/esri/copyright.txt for details.
//>>built
define("../../../geometry/Extent ../../../core/watchUtils ../../../core/HandleRegistry ../engine/Bitmap ../viewpointUtils ./LayerView2D".split(" "),function(f,g,h,k,e,l){return l.createSubclass({declaredClass:"esri.views.2d.layers.DynamicLayerView2D",constructor:function(b){this._hdls=new h;this._hdls.add([g.watch(this,"view.state.version,view.stationary,suspended,layer.exportImageParameters.version",this._update.bind(this))])},destroy:function(){this._hdls.destroy();this._hdls=null},_update:function(){if(this.view.stationary&&
!this.suspended){var b=this.view.state,d=this.layer,a=b.size.concat();this._imagePromise&&(this._imagePromise.cancel(),this._imagePromise=null);10.3>d.version&&e.getOuterSize(a,b.viewpoint,a);a[0]=Math.min(a[0],d.maxImageWidth||2048);a[1]=Math.min(a[1],d.maxImageHeight||2048);this.updating=!0;this._imagePromise=d.fetchImage({extent:e.getExtent(new f,b.viewpoint,a),width:a[0],height:a[1],rotation:b.rotation});this._imagePromise.then(function(a){var c=a.options,b=this.container;this._imagePromise=null;
this.view.stationary&&!this.suspended&&(b.removeAllChildren(),b.addChild(new k({coords:[c.extent.center.x,c.extent.center.y],resolution:c.extent.width/c.width,size:[0.5*c.width,0.5*c.height],source:a.img,rotation:-c.rotation})))}.bind(this),function(a){"cancel"!==a.dojoType&&(this.container.removeAllChildren(),this._imagePromise=null)}.bind(this)).always(function(){this.updating=!1}.bind(this))}}})});