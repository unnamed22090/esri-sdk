// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.0/esri/copyright.txt for details.
//>>built
define("../../../core/HandleRegistry ../../../core/promiseUtils ../../../core/Error ../../../layers/graphics/QueryEngine ./LayerView2D ./GraphicsView2D".split(" "),function(b,c,d,e,f,g){return f.createSubclass({declaredClass:"esri.views.2d.layers.GraphicsLayerView2D",classMetadata:{properties:{updating:{dependsOn:["_controller.isQueryInProgress","_controller._socketConnector.status"],getter:function(){return!0===this.get("_controller.isQueryInProgress")||0===this.get("_controller._socketConnector.status")}}}},
constructor:function(){this._rendererChanged=this._rendererChanged.bind(this);this._handlesGLV=new b},initialize:function(){this._createController().then(this._startup.bind(this)).otherwise(function(){console.log("GraphicsLayerView2D: unable to startup graphics layer view.")})},destroy:function(){this._handlesGLV.destroy();this._controller&&this._controller.destroy&&this._controller.destroy();this._graphicsView&&this._graphicsView.destroy();this._handlesGLV=this._controller=this._graphicsView=null},
layer:null,view:null,_controller:null,_graphics:null,_graphicsView:null,_handlesGLV:null,hitTest:function(a,b){return this._graphicsView?this._graphicsView.hitTest(a,b):null},queryGraphics:function(){return this._queryEngine?this._queryEngine.queryFeatures():this._rejectQuery()},queryFeatures:function(a){return this._queryEngine?this._queryEngine.queryFeatures(a):this._rejectQuery()},queryObjectIds:function(a){return this._queryEngine?this._queryEngine.queryObjectIds(a):this._rejectQuery()},queryFeatureCount:function(a){return this._queryEngine?
this._queryEngine.queryFeatureCount(a):this._rejectQuery()},queryExtent:function(a){return this._queryEngine?this._queryEngine.queryExtent(a):this._rejectQuery()},_startup:function(){this._queryEngine=new e({features:this._graphics,objectIdField:this.layer.objectIdField});this._createGraphicsView();this._setupWatchers()},_createController:function(){return this.layer.createGraphicsController({layerView:this}).then(function(a){this._controller=a;this._graphics=a.graphics}.bind(this)).otherwise(function(){console.log("GraphicsLayerView2D: unable to create controller.")})},
_createGraphicsView:function(){this._graphicsView=new g({view:this,graphics:this._graphics,renderer:this.layer.renderer})},_setupWatchers:function(){this._handlesGLV.add(this.layer.watch("renderer",this._rendererChanged))},_rendererChanged:function(){this._graphicsView.renderer=this.layer.renderer},_rejectQuery:function(a){return c.reject(new d("GraphicsLayerView2D","Not ready to execute query"))}})});