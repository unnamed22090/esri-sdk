// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.0/esri/copyright.txt for details.
//>>built
define(["./math/vec2","./Tile"],function(c,n){var m=function(a,b,d){this.z=b.level;this.scale=b.scale;var e=a.spatialReference._getInfo(),f=c.fromValues(a.origin.x,a.origin.y),g=c.fromValues(a.cols*b.resolution,a.rows*b.resolution),h=c.fromValues(-Infinity,-Infinity),k=c.fromValues(Infinity,Infinity),l=c.fromValues(Infinity,Infinity);d&&(c.set(h,Math.max(0,Math.floor((d.xmin-f[0])/g[0])),Math.max(0,Math.floor((f[1]-d.ymax)/g[1]))),c.set(k,Math.max(0,Math.floor((d.xmax-f[0])/g[0])),Math.max(0,Math.floor((f[1]-
d.ymin)/g[1]))),c.set(l,k[0]-h[0]+1,k[1]-h[1]+1));this.origin=f;this.norm=g;this.start=h;this.end=k;this.size=l;this.resolution=b.resolution;e?(this.worldSize=c.set(c.create(),Math.ceil(Math.round(2*e.origin[1]/b.resolution)/a.cols),l[1]),this.worldStart=c.set(c.create(),Math.floor((e.origin[0]-f[0])/g[0]),h[1]),this.worldEnd=c.set(c.create(),this.worldSize[0]-this.worldStart[0]-1,k[1]),this.wrap=!0):(this.worldStart=h,this.wldEnd=k,this.worldSize=l,this.wrap=!1)};m.prototype={normalizeX:function(a){if(!this.wrap)return a;
var b=this.worldSize[0];return 0>a?b-1-Math.abs((a+1)%b):a%b},getXForWorld:function(a,b){return!this.wrap?a:this.worldSize[0]*b+a},getWorldForX:function(a){return!this.wrap?a:Math.floor(a/this.worldSize[0])},getWorldStartCol:function(a){return a*this.worldSize[0]+this.start[0]},getWorldEndCol:function(a){return a*this.worldSize[0]+this.start[0]+this.size[0]-1},toGridCol:function(a){return(a-this.origin[0])/this.norm[0]},toGridRow:function(a){return(this.origin[1]-a)/this.norm[1]},getTileOrigin:function(a,
b){var d=this.origin,e=this.norm;return c.set(a,d[0]+this.getXForWorld(b[0],b[3])*e[0],d[1]-b[1]*e[1])},getIntersectingTile:function(a){var b=this.resolution,c=a.lodInfo.resolution;if(a.coords[2]<this.z)return null;b=[Math.floor(a.coords[0]*c/b+0.01),Math.floor(a.row*c/b+0.01),this.z,0];b[3]=this.getXForWorld(b[0],a.world);return new n(b,this)}};return m});