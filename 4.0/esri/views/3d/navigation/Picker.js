// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.0/esri/copyright.txt for details.
//>>built
define(["../../../core/declare","../support/RenderCoordsHelper","../lib/glMatrix","../webgl-engine/lib/Selector"],function(m,l,n,p){var e=n.vec3d,g=e.create(),f=e.create();return m([],{constructor:function(d,b){this.navigation=d;this.pickAlongRay=b._pickRay.bind(b);this.createPickRay=b._pickRayWithBeginPoint.bind(b);this.selector=new p},pickPointInScreen:function(d,b){return this.pickedIntersectionPoint(this.pickInScreen(d,!1),b)},pickFreePointInScreen:function(d,b){this.createPickRay(d,void 0,this.navigation.currentCamera.viewMatrix,
g,f);b||(b=e.create());e.subtract(f,g);e.normalize(f);var c=this.navigation.view.dataExtent,k=Math.max(c.xmax-c.xmin,c.ymax-c.ymin,c.zmax-c.zmin),a=this.navigation.currentCamera,h=Math.max(0,c.xmin-a.eye[0],a.eye[0]-c.xmax),c=Math.max(0,c.ymin-a.eye[1],a.eye[1]-c.ymax),h=Math.sqrt(h*h+c*c),c="global"==this.navigation.view.viewingMode?l.Spherical.prototype.getAltitude(a.eye):l.Planar.prototype.getAltitude(a.eye),a=this.navigation._getTerrainElevationBelowCamera(a),a=Math.abs(c-a)+Number.MIN_VALUE,
a=Math.pow(Math.max(0,Math.log(k/a)),2),a=k/Math.max(1,a),a=Math.max(a,Math.min(h,k));e.scale(f,a);e.add(g,f,b)},pickInScreen:function(d,b){this.createPickRay(d,void 0,this.navigation.currentCamera.viewMatrix,g,f);b&&e.set(this.navigation.currentCamera.eye,g);return this.pickAlongRay(g,f,d,d,null,null,this.selector)},pickedIntersectionPoint:function(d,b){if(!d)return!1;b||(b=e.create());return d.getMinResult().getIntersectionPoint(b)}})});