// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.0/esri/copyright.txt for details.
//>>built
define("../mixins/ConstraintsMixin ../../support/mathUtils ../../support/earthUtils ../../support/RenderCoordsHelper ../../constraints/SceneViewTiltConstraint ../../lib/glMatrix ../../webgl-engine/lib/Util ../../../../geometry/support/scaleUtils".split(" "),function(f,h,q,u,p,r,v,w){var g=r.vec3d,s=r.vec4d,t=s.create(),l=g.create(),m=g.create();return f.createSubclass({declaredClass:"esri.views.3d.navigation.planar.ConstraintsPlanar",defaultConstraints:{tilt:new f.Tilt({min:function(){return h.deg2rad(p.MAX_DEFAULT)},
max:h.makePiecewiseLinearFunction([[4E3,h.deg2rad(p.MIN_DEFAULT)],[1E4,h.deg2rad(88)],[6E6,h.deg2rad(88)]])}),altitude:new f.Altitude({min:function(a){return a._autoAltitudeConstraints.min},max:function(a){return a._autoAltitudeConstraints.max}}),collision:new f.Collision},_updateAutoAltitudeConstraints:function(a){var b=Math.max(a.xmax-a.xmin,a.ymax-a.ymin);a=w.getUnitValueForSR(a.spatialReference);this._autoAltitudeConstraints.max=3*b/Math.atan((this._targetCameraBeforeElevationUpdate||this.targetCamera)._fov/
2);this._autoAltitudeConstraints.min=-this._autoAltitudeConstraints.max;this._autoAltitudeConstraints.min*=a;this._autoAltitudeConstraints.max*=a},limitAltitude:function(a,b,c,e){return this.constraints.altitude.apply(this,a)},limitTiltByAltitudeConstraints:function(a,b,c,e){return a},distanceToSilhouette:function(a,b,c,e,d){d||(d={maxFarNearRatio:0,distance:0});d.maxFarNearRatio=this.maxFarNearRatio;var n=u.Planar.prototype.getAltitude(a.eye),f=n*=c;e=n-e;var k=this.elevationProvider?this.elevationProvider.getElevationBounds():
null;k&&(n=0<=e?f-c*k[0]:c*k[1]-f);f=Math.max(b.xmax-b.xmin,b.ymax-b.ymin,b.zmax-b.zmin);g.subtract(a.center,a.eye,m);l[0]=0<m[0]?b.xmax:b.xmin;l[1]=0<m[1]?b.ymax:b.ymin;l[2]=0<m[2]?b.zmax:b.zmin;g.subtract(l,a.eye);g.normalize(m);a=g.dot(l,m);a=1.1*a*c;k=n+q.earthRadius;k=Math.sqrt(k*k-q.earthRadius*q.earthRadius);b=Math.max(b.xmax-b.xmin,b.ymax-b.ymin);var p=1E-4*b*c;c=h.clamp((n-p)/(0.0010*b*c-p),0,1);d.distance=h.lerp(k,a,c*c*c);d.maxFarNearRatio=h.clamp(2E6-2E6*((Math.log(Math.abs(e))-9.55)/
(11.27-9.55)),2E4,2E6);d.distance*=Math.max(100*Math.log(Math.abs(e)),1);d.distance=Math.min(d.distance,Math.max(34064E4,f));return d},intersectManifold:function(a,b,c,e){var d=this.renderCoordsHelper.worldUp;s.set4(d[0],d[1],d[2],c,t);return!v.rayPlane(a,b,t,e)||0>g.dot(g.subtract(e,a,l),b)?!1:!0},getCenterIntersectTerrainFallback:function(a,b,c){g.set(b,c)}})});