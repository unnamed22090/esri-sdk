// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.0/esri/copyright.txt for details.
//>>built
define("../mixins/ConstraintsMixin ../../support/mathUtils ../../support/earthUtils ../../lib/glMatrix ../../constraints/SceneViewAltitudeConstraint ../../constraints/SceneViewTiltConstraint ../../webgl-engine/lib/Util".split(" "),function(k,d,g,q,n,m,r){var f=q.vec3d,l=f.create();return k.createSubclass({declaredClass:"esri.views.3d.navigation.spherical.ConstraintsSpherical",defaultConstraints:{tilt:new k.Tilt({min:function(){return d.deg2rad(m.MAX_DEFAULT)},max:d.makePiecewiseLinearFunction([[4E3,
d.deg2rad(m.MIN_DEFAULT)],[5E4,d.deg2rad(88)],[6E6,d.deg2rad(88)],[2E7,d.deg2rad(m.MAX_DEFAULT)]])}),altitude:new k.Altitude({min:function(){return n.MIN_DEFAULT},max:function(){return n.MAX_DEFAULT}}),collision:new k.Collision},limitAltitude:function(b,a,c,h){f.scale(c,b/h,l);f.subtract(a,l,l);var e=this.renderCoordsHelper.getAltitude(l),d=this.constraints.altitude.apply(this,e);if(1E-6<Math.abs(e-d)){b=f.length(a);d+=g.earthRadius;a=f.dot(c,a)/(b*h);a*=-2*b;c=a*a-4*(-(d*d)+b*b);if(0>c)return this.minPoiDist;
c=Math.sqrt(c);return c<a?(a-c)/2:(c-a)/2}return b},limitTiltByAltitudeConstraints:function(b,a,c,h){a=f.length(a);var e=a*a,k=c*c,l=Math.sqrt(e+k-2*a*c*Math.cos(Math.PI-b))-g.earthRadius,m=this.constraints.altitude.min(),n=this.constraints.altitude.max(),p;if((void 0===h||0<h)&&l<m)p=m;else if((void 0===h||0>h)&&l>n)p=n;void 0!==p&&(b=p+g.earthRadius,b=Math.PI-d.acos((-(b*b)+e+k)/(2*a*c)));return b},distanceToSilhouette:function(b,a,c,h,e){e||(e={maxFarNearRatio:0,distance:0});b=f.dot(b.eye,b.eye);
a=g.earthRadius*g.earthRadius;e.maxFarNearRatio=this.maxFarNearRatio;b>a?(e.maxFarNearRatio=d.clamp(2E4-19E3*((Math.log(Math.sqrt(b)-g.earthRadius)-7.983)/9.011),1E3,2E4),e.distance=Math.sqrt(b-a)):e.distance=this.maxFarNearRatio*this.minNearDistance;e.distance*=1.2;return e},intersectManifold:function(b,a,c,d){return r.raySphereClosestPositive(b,a,g.earthRadius+c,d)},getCenterIntersectTerrainFallback:function(b,a,c){a=f.dot(b,b);var d=g.earthRadius*g.earthRadius;a=a>d?Math.sqrt(a-d)/3:1;f.scale(c,
a/f.length(c),c);f.add(c,b)}})});