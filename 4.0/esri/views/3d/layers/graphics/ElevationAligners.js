// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.0/esri/copyright.txt for details.
//>>built
define(["../../../../geometry/Point","../../lib/glMatrix","../../webgl-engine/lib/Util","./Graphics3DSymbolCommonCode"],function(q,d,r,t){var x=r.VertexAttrConstants;d=d.vec3d;var l=new q,g=d.create(),a=d.create(),k=d.create();return{perVertexElevationAligner:function(p,e,u){var h=p.stageObject;p=p.elevationInfo;l.spatialReference=e.spatialReference;for(var d=h.getGeometryRecords(),q=d.length,m=0;m<q;m++){var b=d[m].geometry,f=d[m].transformation;a[0]=f[12];a[1]=f[13];a[2]=f[14];b.invalidateBoundingInfo();
for(var f=b.getData().getVertexAttr(),b=f[x.POSITION].data,f=f.mapPos.data,r=b.length/2,c=0,s=0,v=!1,w=0;w<r;w++){l.x=f[s++];l.y=f[s++];l.z=f[s++];k[0]=b[c];k[1]=b[c+1];k[2]=b[c+2];var n=t.computeElevation(e,l,p);g[0]=b[c]+a[0];g[1]=b[c+1]+a[1];g[2]=b[c+2]+a[2];u.setAltitude(n,g,0);b[c]=g[0]-a[0];b[c+1]=g[1]-a[1];b[c+2]=g[2]-a[2];n=0.01/u.unitInMeters;if(Math.abs(k[0]-b[c])>n||Math.abs(k[1]-b[c+1])>n||Math.abs(k[2]-b[c+2])>n)v=!0;c+=3}v&&h.geometryVertexAttrsUpdated(m)}},perObjectElevationAligner:function(d,
e,a){var h=d.elevationInfo,g=t.computeElevation(e,h.centerPointInElevationSR,h);e=d.stageObject.getObjectTransformation();h=[e[12],e[13],e[14]];a.setAltitudeOfTransformation(g,e);a=0.01/a.unitInMeters;(Math.abs(e[12]-h[0])>a||Math.abs(e[13]-h[1])>a||Math.abs(e[14]-h[2])>a)&&d.stageObject.setObjectTransformation(e)}}});