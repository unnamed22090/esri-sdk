// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.0/esri/copyright.txt for details.
//>>built
define("dojo/request/xhr ../../../core/declare ../../../core/watchUtils ../../../core/promiseUtils ../../../core/Error ../../layers/LayerView ../terrain/TilingScheme ../terrain/terrainUtils ./support/LayerViewUpdatingPercentage".split(" "),function(g,h,k,e,f,l,m,n,p){function q(a){if(!a)return!1;var b=-1!==a.indexOf(".arcgis.com/")||-1!==a.indexOf(".arcgisonline.com/");a=-1!==a.indexOf("//services")||-1!==a.indexOf("//tiles")||-1!==a.indexOf("//features");return b&&a}function r(a){var b=null,c=a.search(/\/rest\/services\//i);
0<c&&(b=a.substring(0,c+6));return b}return h([l,p],{declaredClass:"esri.views.3d.layers.TiledLayerView3D",_numUpdating:0,_maxNumUpdating:0,minDataLevel:0,maxDataLevel:Infinity,initialize:function(){var a=this.layer.tileInfo,b=m.checkUnsupported(a);b&&this.addResolvingPromise(e.reject(b));b=k.whenTrueOnce(this.view,"basemapTerrain.tilingSchemeLocked").then(function(){if(!this.view.basemapTerrain.tilingScheme.compatibleWith(a))return e.reject(f("tiledlayerview3d:tiling-scheme-incompatible","The tiling scheme of this layer is incompatible with the tiling scheme of the surface"))}.bind(this));
this.addResolvingPromise(b);var c=Infinity,d=0;a.lods.forEach(function(a){c=Math.min(a.level,c);d=Math.max(a.level,d)});d=Math.min(d,n.getKnownTiledServiceLevelCap(this.layer.url));this.minDataLevel=c;this.maxDataLevel=d},getTileUrl:function(a,b,c){return this.layer.getTileUrl(a,b,c)},isTransparent:function(){return this.layer.tileInfo&&"JPEG"!==this.layer.tileInfo.format},_checkServiceVersionCompatibility:function(){if(!q(this.layer.url))if(10.22>this.layer.version)this.addResolvingPromise(e.reject(f("tiledlayerview3d:service-version-not-supported",
"Tiled Map Layers on servers prior to 10.2.2 are not supported. Detected version: "+this.layer.version,"service-too-old")));else if(10.22===this.layer.version){var a=r(this.layer.url),b=f("tiledlayerview3d:service-version-not-supported","Tiled Map Layers from 10.2.2 servers are only supported if all server updates have been applied.","cors-patch-missing"),a=g(a+"self?f\x3djson",{headers:{"X-Requested-With":null},timeout:1E4,handleAs:"json"}).then(function(a){if(!a||a.error)throw b;}).otherwise(function(){throw b;
});this.addResolvingPromise(a)}}})});