// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.0/esri/copyright.txt for details.
//>>built
define(["require","exports","./Texture","./ModelContentType"],function(n,p,l,h){var k=function(){function a(a){this.textTextures={};this.id=l.idGen.gen(a)}a.prototype.getId=function(){return this.id};a.prototype.dispose=function(){};a.prototype.deferredLoading=function(){return!1};a.prototype.getWidth=function(){return 512};a.prototype.getHeight=function(){return 512};a.prototype.renderGl=function(a,b){this._createTextTexture(a,b);b._isTracingEnabled&&(a._debugTracingType="TextTextureAtlas")};a.prototype._createTextTexture=
function(m,b){var c=a._create2Dcanvas(),d=c.getContext("2d");d.save();d.clearRect(0,0,512,512);b.bindTexture(b.TEXTURE_2D,m);for(var e in this.textTextures){var f=this.textTextures[e];f.textTexture.renderText(1,f.placement.width,f.placement.height,d,f.placement.atlasOffX,f.placement.atlasOffY)}b.texImage2D(b.TEXTURE_2D,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,c);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE);b.texParameteri(b.TEXTURE_2D,
b.TEXTURE_MAG_FILTER,b.LINEAR);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.LINEAR);b.bindTexture(b.TEXTURE_2D,null);d.restore()};a.prototype.setUnloadFunc=function(a){this._unloadFunc=a};a.prototype.unload=function(){null!=this._unloadFunc&&(this._unloadFunc(this.id),this._unloadFunc=null)};a._create2Dcanvas=function(){a._textCanvas2D||(a._textCanvas2D=document.createElement("canvas"),a._textCanvas2D.setAttribute("id","canvas2d"),a._textCanvas2D.setAttribute("width",(512).toString()),a._textCanvas2D.setAttribute("height",
(512).toString()),a._textCanvas2D.setAttribute("style","display:none"));return a._textCanvas2D};return a}();return function(){function a(a,b){this._textureAtlasSubtextures=[];this._curLineHeight=this._curY=this._curX=0;this._idHint=a;this._stage=b}a.prototype.dispose=function(){for(var a=0;a<this._textureAtlasSubtextures.length;a++)this._stage.remove(h.TEXTURE,this._textureAtlasSubtextures[a].getId());this._textureAtlasSubtextures=[]};a.prototype.addTextTexture=function(a){for(var b=JSON.stringify(a.getParams())+
"_"+a.getString(),c=0;c<this._textureAtlasSubtextures.length;c++){var d=this._textureAtlasSubtextures[c].textTextures[b];if(null!=d)return d.placement}var e=null;0===this._textureAtlasSubtextures.length&&(e=new k(this._idHint),this._textureAtlasSubtextures.push(e));var c=a.getTextWidth(),d=a.getTextHeight(),f,g;this._curLineHeight=Math.max(this._curLineHeight,d);512>this._curX+c&&512>this._curY+this._curLineHeight||(512>this._curY+this._curLineHeight+d?(this._curX=0,this._curY+=this._curLineHeight):
(e=new k(this._idHint),this._textureAtlasSubtextures.push(e),this._curY=this._curX=0),this._curLineHeight=d);f=this._curX;g=this._curY;this._curX+=c;null!=e&&this._stage.add(h.TEXTURE,e);e=this._textureAtlasSubtextures[this._textureAtlasSubtextures.length-1];c={uvMinMax:[f/512,1-(g+d)/512,(f+c)/512,1-g/512],atlasOffX:f,atlasOffY:g,width:c,height:d,texture:e};e.textTextures[b]={placement:c,textTexture:a};return c};return a}()});