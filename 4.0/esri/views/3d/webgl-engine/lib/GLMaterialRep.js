// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.0/esri/copyright.txt for details.
//>>built
define(["require","exports","./Util"],function(h,k,f){var g=function(){function b(a){this.refCnt=0;this.glMaterial=a}b.prototype.incRefCnt=function(){++this.refCnt};b.prototype.decRefCnt=function(){--this.refCnt;f.assert(0<=this.refCnt)};b.prototype.getRefCnt=function(){return this.refCnt};b.prototype.getGLMaterial=function(){return this.glMaterial};return b}();return function(){function b(a,b){this.textureRep=a;this.programRep=b;this.id2glMaterialRef={}}b.prototype.aquire=function(a){return this.aquireExt(a,
"color")};b.prototype.aquireDepthShadowMap=function(a){return this.aquireExt(a,"depthShadowMap")};b.prototype.aquireDepth=function(a){return this.aquireExt(a,"depth")};b.prototype.aquireNormal=function(a){return this.aquireExt(a,"normal")};b.prototype.aquireHighlight=function(a){return this.aquireExt(a,"highlight")};b.prototype.aquireExt=function(a,b){var d;d=a.getId()+"_"+b;var c=this.id2glMaterialRef[d],e;null==c?(e=(c=a.getGLMaterials()[b])?new c(a,this.programRep,this.textureRep):void 0,c=new g(e),
this.id2glMaterialRef[d]=c):e=c.getGLMaterial();c.incRefCnt();e&&this.increaseProgramReferences(e);return e};b.prototype.release=function(a){this.releaseExt(a,"color")};b.prototype.releaseDepth=function(a){this.releaseExt(a,"depth")};b.prototype.releaseNormal=function(a){this.releaseExt(a,"normal")};b.prototype.releaseDepthShadowMap=function(a){this.releaseExt(a,"depthShadowMap")};b.prototype.releaseHighlight=function(a){this.releaseExt(a,"highlight")};b.prototype.releaseExt=function(a,b){var d=a+
"_"+b,c=this.id2glMaterialRef[d];c.decRefCnt();if(0===c.getRefCnt()){if(c=c.getGLMaterial())this.decreaseProgramReferences(c),void 0!==c.dispose&&c.dispose();delete this.id2glMaterialRef[d]}};b.prototype.updateMaterialParameters=function(a){var b=this.id2glMaterialRef[a+"_color"];b&&b.getGLMaterial()&&this.updateParamsForMat(b.getGLMaterial());(b=this.id2glMaterialRef[a+"_depth"])&&b.getGLMaterial()&&this.updateParamsForMat(b.getGLMaterial());(a=this.id2glMaterialRef[a+"_normal"])&&a.getGLMaterial()&&
this.updateParamsForMat(a.getGLMaterial())};b.prototype.updateParamsForMat=function(a){a.updateVisibility();a.updateParameters&&a.updateParameters()};b.prototype.increaseProgramReferences=function(a){if(a.getAllPrograms){a=a.getAllPrograms();for(var b=0;b<a.length;b++)this.programRep.increaseRefCount(a[b])}else this.programRep.increaseRefCount(a.getProgram())};b.prototype.decreaseProgramReferences=function(a){if(a.getAllPrograms){a=a.getAllPrograms();for(var b=0;b<a.length;b++)this.programRep.decreaseRefCount(a[b])}else this.programRep.decreaseRefCount(a.getProgram())};
return b}()});