// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.0/esri/copyright.txt for details.
//>>built
define("require exports ./IdGen ./Util ./GLUtil ./DDSUtil".split(" "),function(q,r,k,m,l,n){function p(c,b,e,a,h,g,d,k){d=!1!==d;var f=new Image;f.src=c;f.onerror=function(){g();f.onerror=void 0;f.onload=void 0};f.onload=function(){e.isTexture(b)&&l.texImage2D(f,b,e,a,h,d,!0,k);g();f.onerror=void 0;f.onload=void 0}}return function(){function c(b,e,a){this.data=b;this.id=c.idGen.gen(e);this.unloadFunc=void 0;this.params=a||{};this.params.wrapClamp=this.params.wrapClamp||!1;this.params.mipmap=!1!==
this.params.mipmap;this.params.noUnpackFlip=this.params.noUnpackFlip||!1;this.estimatedTexMemRequiredMB=c.estimateTexMemRequiredMB(this.data,this.params)}c.estimateTexMemRequiredMB=function(b,c){return null==b?0:b instanceof ArrayBuffer||b instanceof Uint8Array?b.byteLength/1E6:4*1.3*c.width*c.height/1E6};c.prototype.getId=function(){return this.id};c.prototype.getEstimatedTexMemRequiredMB=function(){return this.estimatedTexMemRequiredMB};c.prototype.dispose=function(){this.data=void 0};c.prototype.deferredLoading=
function(){return"string"===typeof this.data};c.prototype.getWidth=function(){return this.params.width};c.prototype.getHeight=function(){return this.params.height};c.prototype.loadDDS=function(b,c){var a=n.uploadDDSLevels(b,c,this.params.mipmap);null!==a&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.LINEAR),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,1<a.mipmapCount?b.LINEAR_MIPMAP_LINEAR:b.LINEAR),this.params.width=a.width,this.params.height=a.height)};c.prototype.loadGl=function(b,
e,a,h,g){var d=this.data;if("string"===typeof d)p(d,e,a,h,g,b,this.params.mipmap,this.params.noUnpackFlip);else if(d instanceof Image||d instanceof ImageData||d instanceof HTMLCanvasElement)this.params.width=d.width,this.params.height=d.height,l.texImage2D(this.data,e,a,h,g,this.params.mipmap,this.params.mipmap||!this.params.wrapClamp,this.params.noUnpackFlip);else if(d instanceof ArrayBuffer&&this.params.encoding===c.DDS_ENCODING)this.loadDDS(a,d);else if(d instanceof Uint8Array&&this.params.encoding===
c.DDS_ENCODING)this.loadDDS(a,d.buffer);else if(d instanceof Uint8Array)!0===this.params.noUnpackFlip&&a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,!1),m.assert(0<this.params.width&&0<this.params.height),b=a.RGBA,1===this.params.components&&(b=a.LUMINANCE),a.texImage2D(a.TEXTURE_2D,0,b,this.params.width,this.params.height,0,b,a.UNSIGNED_BYTE,d),this.params.mipmap?(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR_MIPMAP_LINEAR),a.generateMipmap(a.TEXTURE_2D)):a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,
a.LINEAR),!0===this.params.noUnpackFlip&&a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,!0);else if(null!==d)throw console.warn("Unsupported image data"),Error("Unsupported image data");a._isTracingEnabled&&(e._debugTracingType="Texture");this.data=void 0};c.prototype.setUnloadFunc=function(b){this.unloadFunc=b};c.prototype.unload=function(){void 0!==this.unloadFunc&&(this.unloadFunc(this.id),this.unloadFunc=void 0)};c.idGen=new k;c.DDS_ENCODING="image/vnd-ms.dds";return c}()});