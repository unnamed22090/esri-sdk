// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.0/esri/copyright.txt for details.
//>>built
define(["./internal/MaterialUtil","../lib/Util","../lib/gl-matrix","../lib/RenderSlot"],function(q,w,x,D){var a=x.vec3d,y=x.vec2d,z=x.mat4d,E=w.VertexAttrConstants,d=a.create(),b=a.create(),l=a.create(),u=a.create(),r=y.create(),s=y.create(),A=a.create(),B=a.create(),m=function(p,C,e,v){"string"===typeof e&&(v=e,e=void 0);q.basicMaterialConstructor(this,v);this.lineType=e||m.LINES;var g=q.Layouts.Pos,t=g.getStride();this.canBeMerged=this.lineType===m.LINES;this.setColor=function(c){C=c;this.notifyDirty("matChanged")};
this.getColor=function(){return C};this.dispose=function(){};this.getOutputAmount=function(c){c=c/2+1;if(this.lineType===m.STRIP)return c*t;if(this.lineType===m.LINES)return(2*c-2)*t};this.getVertexBufferLayout=function(){return g};this.fillInterleaved=function(c,a,h,g,d,b){c=c.vertexAttr[E.POSITION].data;if(a||this.lineType===m.LINES){g=c.length/3;for(h=0;h<g;h++){var k=3*h,f=c[k],e=c[k+1],n=c[k+2];if(a)var k=f,l=e,f=a[0]*k+a[4]*l+a[8]*n+a[12],e=a[1]*k+a[5]*l+a[9]*n+a[13],n=a[2]*k+a[6]*l+a[10]*n+
a[14];d[b++]=f;d[b++]=e;d[b++]=n;this.lineType===m.LINES&&(0!==h&&h!==g-1)&&(d[b++]=f,d[b++]=e,d[b++]=n)}}else for(h=0;h<c.length;h++)d[b++]=c[h]};this.intersect=function(c,g,h,e,m,t,k,f,p,n,v,q){if(q){c=c.getData().getVertexAttr("position").position.data;g=Number.MAX_VALUE;for(k=0;k<c.length-5;k+=3){d[0]=c[k];d[1]=c[k+1];d[2]=c[k+2];z.multiplyVec3(h,d);b[0]=c[k+3];b[1]=c[k+4];b[2]=c[k+5];z.multiplyVec3(h,b);p.projectPoint(d,r);p.projectPoint(b,s);if(0>r[2]&&0<s[2])a.subtract(d,b,l),f=p.frustumPlanes,
n=-(a.dot(f[4],d)+f[4][3]),f=n/a.dot(l,f[4]),a.scale(l,f,l),a.add(d,l,d),p.projectPoint(d,r);else if(0<r[2]&&0>s[2])a.subtract(b,d,l),f=p.frustumPlanes,n=-(a.dot(f[4],b)+f[4][3]),f=n/a.dot(l,f[4]),a.scale(l,f,l),a.add(b,l,b),p.projectPoint(b,s);else if(0>r[2]&&0>s[2])continue;f=w.projectVectorVector2D(r,s,e);f<g&&(g=f,a.set(d,A),a.set(b,B))}2>g&&(h=w.linelineDistance3D(A,B,m,t),e=Number.MAX_VALUE,h[0]&&(a.subtract(h[2],m,u),h=a.length(u),a.scale(u,1/h),e=0.98*h/a.dist(m,t)),v(e,u))}};this.getGLMaterials=
function(){return{color:F,depthShadowMap:void 0,normal:void 0,depth:void 0,highlight:void 0}};this.getAllTextureIds=function(){return[]}};m.STRIP=1;m.LINES=2;var F=function(a,d){q.basicGLMaterialConstructor(this,a);var e=d.get("simple"),b=a.getColor();this.beginSlot=function(a){return a===D.OPAQUE_MATERIAL};this.getProgram=function(){return e};this.bind=function(g,d){e.use();e.uniform4fv("color",b);a.getVertexBufferLayout().enableVertexAttribArrays(g,e);1>b[3]&&g.enable(g.BLEND)};this.release=function(g){a.getVertexBufferLayout().disableVertexAttribArrays(g,
e);1>b[3]&&g.disable(g.BLEND)};this.bindView=function(a,b){q.bindView(b.origin,b.view,e)};this.bindInstance=function(a,b){e.uniformMatrix4fv("model",b.transformation)};this.getDrawMode=function(b){return a.lineType===m.STRIP?b.LINE_STRIP:b.LINES}};return m});