// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.0/esri/copyright.txt for details.
//>>built
define(["./Layer","./mixins/PortalLayer","../support/LayersMixin","../core/JSONSupport"],function(e,f,g,h){return e.createSubclass([g,h,f],{declaredClass:"esri.layers.GroupLayer",portalLoaderModule:"portal/loaders/GroupLayerLoader",viewModulePaths:{"2d":"../views/layers/GroupLayerView","3d":"../views/layers/GroupLayerView"},constructor:function(a){this._lyrVisibleHandles={};this._lyrVisibleWatcher=this._lyrVisibleWatcher.bind(this)},initialize:function(){this._enforceVisibility(this.visibilityMode,
this.visible);this.watch("visible",this._visibleWatcher)},properties:{fullExtent:{value:void 0},spatialReference:{value:void 0},visibilityMode:{value:"independent",set:function(a){this._get("visibilityMode")!==a&&(this._enforceVisibility(a,this.visible),this._set("visibilityMode",a))}}},load:function(){this.addResolvingPromise(this.loadFromPortal())},layerAdded:function(a,b){a.visible&&"exclusive"===this.visibilityMode?this._turnOffOtherLayers(a):"inherited"===this.visibilityMode&&(a.visible=this.visible);
this._lyrVisibleHandles[a.uid]=a.watch("visible",this._lyrVisibleWatcher)},layerRemoved:function(a,b){var c=this._lyrVisibleHandles[a.uid];c&&(c.remove(),delete this._lyrVisibleHandles[a.uid]);this._enforceVisibility(this.visibilityMode,this.visible)},_turnOffOtherLayers:function(a){this.layers.forEach(function(b){b!==a&&(b.visible=!1)})},_enforceVisibility:function(a,b){if(this.__accessor__.initialized){var c=this.layers,d=c.find(function(a){return a.visible});switch(a){case "exclusive":c.length&&
!d&&(d=c.getItemAt(0),d.visible=!0);this._turnOffOtherLayers(d);break;case "inherited":c.forEach(function(a){a.visible=b},this)}}},_visibleWatcher:function(a){"inherited"===this.visibilityMode&&this.layers.forEach(function(b){b.visible=a})},_lyrVisibleWatcher:function(a,b,c,d){b=this.layers.some(function(a){return a.visible});switch(this.visibilityMode){case "exclusive":a?this._turnOffOtherLayers(d):b||(d.visible=!0);break;case "inherited":d.visible=this.visible}}})});