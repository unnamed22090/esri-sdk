// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.0/esri/copyright.txt for details.
//>>built
define("../core/declare ../core/lang dojo/_base/array dojo/_base/lang ../symbols/support/jsonUtils ./Renderer".split(" "),function(l,d,g,e,h,m){var k=l(m,{declaredClass:"esri.renderer.UniqueValueRenderer",type:"uniqueValue",classMetadata:{properties:{requiredFields:{dependsOn:["field","field2","field3"]},expressionTree:{dependsOn:["expression"]}},reader:{exclude:["field1"],add:["field"]}},constructor:function(){this._symbols={}},getDefaults:function(){return e.mixin(this.inherited(arguments),{field:null,
field2:null,field3:null,expression:null,defaultLabel:null,defaultSymbol:null,fieldDelimiter:null,uniqueValueInfos:[]})},_defaultSymbolReader:h.fromJSON,_fieldReader:function(b,a){return a.field1},_uniqueValueInfosSetter:function(b){this._symbols={};g.forEach(b,this._processUVInfo,this);return b},collectRequiredFields:function(b){this.inherited(arguments);[this.field,this.field2,this.field3].forEach(function(a){a&&(b[a]=!0)})},expressionTree:null,_expressionTreeGetter:function(){return this.expression?
this._parseExpr(this.expression,{vars:{$feature:"any"}}):null},addUniqueValueInfo:function(b,a){var c=e.isObject(b)?b:{value:b,symbol:a};this.uniqueValueInfos.push(c);this._processUVInfo(c)},removeUniqueValueInfo:function(b){var a=-1;g.some(this.uniqueValueInfos,function(c,e){if(c.value==b)return a=e,!0});-1!==a&&(delete this._symbols[b],this.uniqueValueInfos.splice(a,1))},getUniqueValueInfo:function(b){var a=this.field,c=b.attributes,d,f;this.expression?a=this._executeExpr(this.expressionTree,this._createExprContext(b)):
this.field2?(b=this.field2,d=this.field3,f=[],a&&f.push(c[a]),b&&f.push(c[b]),d&&f.push(c[d]),a=f.join(this.fieldDelimiter||"")):a=e.isFunction(a)?a(b):c[a];return this._symbols[a]},getSymbol:function(b){return(b=this.getUniqueValueInfo(b))&&b.symbol||this.defaultSymbol},toJSON:function(){var b=d.fixJson,a=e.mixin(this.inherited(arguments),{type:this.type,field1:this.field,field2:this.field2,field3:this.field3,expression:this.expression,fieldDelimiter:this.fieldDelimiter,defaultSymbol:this.defaultSymbol&&
this.defaultSymbol.toJSON(),defaultLabel:this.defaultLabel,uniqueValueInfos:g.map(this.uniqueValueInfos||[],function(a){a=e.mixin({},a);a.symbol=a.symbol&&a.symbol.toJSON();a.value+="";return b(a)})});return b(a)},clone:function(){return new k({field:this.field,field2:this.field2,field3:this.field3,defaultLabel:this.defaultLabel,defaultSymbol:this.defaultSymbol&&this.defaultSymbol.clone(),expression:this.expression,fieldDelimiter:this.fieldDelimiter,uniqueValueInfos:d.clone(this.uniqueValueInfos),
visualVariables:d.clone(this.visualVariables)})},_processUVInfo:function(b){var a=b.value,c=b.symbol;c&&!c.declaredClass&&(b.symbol=h.fromJSON(c));this._symbols[a]=b}});return k});