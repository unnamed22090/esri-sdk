/*! ArcGIS API for JavaScript 4.1 | Copyright (c) 2016 Esri. All rights reserved. | http://www.esri.com/legal/privacy | https://developers.arcgis.com/terms/faq */
define(["dojo/_base/declare","dojo/_base/lang","dojo/cookie","dojo/topic","dojo/query","dojo/dom-construct","Notifications","esri/config","esri/request","esri/core/urlUtils"],function(e,t,o,a,r,n,i,s,c,l){var d=/^(https?:\/\/(arcgis.com|esri.com|.+.arcgis.com|.+.esri.com)|\/)/;s.request.proxyUrl="/proxy",s.request.corsEnabledServers.push(SiteConfig.billing),s.request.corsEnabledServers.push(SiteConfig.download_server),s.request.corsEnabledServers.push("https://geotriggerstg.arcgis.com"),s.request.corsEnabledServers.push("https://geotriggerdev.arcgis.com"),s.request.corsEnabledServers.push("https://geotrigger.arcgis.com"),s.request.corsEnabledServers.push("https://portalette.geotrigger.arcgis.com"),s.request.corsEnabledServers.push("https://portalettestg.geotrigger.arcgis.com");var u=e([],{constructor:function(e){t.mixin(this,e)},_callbacks:[],ready:!1,get_gravatar:function(e,t){var o=function(e){function t(e,t){return e<<t|e>>>32-t}function o(e,t){var o,a,r,n,i;return r=2147483648&e,n=2147483648&t,o=1073741824&e,a=1073741824&t,i=(1073741823&e)+(1073741823&t),o&a?2147483648^i^r^n:o|a?1073741824&i?3221225472^i^r^n:1073741824^i^r^n:i^r^n}function a(e,t,o){return e&t|~e&o}function r(e,t,o){return e&o|t&~o}function n(e,t,o){return e^t^o}function i(e,t,o){return t^(e|~o)}function s(e,r,n,i,s,c,l){return e=o(e,o(o(a(r,n,i),s),l)),o(t(e,c),r)}function c(e,a,n,i,s,c,l){return e=o(e,o(o(r(a,n,i),s),l)),o(t(e,c),a)}function l(e,a,r,i,s,c,l){return e=o(e,o(o(n(a,r,i),s),l)),o(t(e,c),a)}function d(e,a,r,n,s,c,l){return e=o(e,o(o(i(a,r,n),s),l)),o(t(e,c),a)}function u(e){for(var t,o=e.length,a=o+8,r=(a-a%64)/64,n=16*(r+1),i=Array(n-1),s=0,c=0;c<o;)t=(c-c%4)/4,s=c%4*8,i[t]=i[t]|e.charCodeAt(c)<<s,c++;return t=(c-c%4)/4,s=c%4*8,i[t]=i[t]|128<<s,i[n-2]=o<<3,i[n-1]=o>>>29,i}function p(e){var t,o,a="",r="";for(o=0;o<=3;o++)t=e>>>8*o&255,r="0"+t.toString(16),a+=r.substr(r.length-2,2);return a}function h(e){e=e.replace(/rn/g,"n");for(var t="",o=0;o<e.length;o++){var a=e.charCodeAt(o);a<128?t+=String.fromCharCode(a):a>127&&a<2048?(t+=String.fromCharCode(a>>6|192),t+=String.fromCharCode(63&a|128)):(t+=String.fromCharCode(a>>12|224),t+=String.fromCharCode(a>>6&63|128),t+=String.fromCharCode(63&a|128))}return t}var f,m,g,v,b,y,S,w,j,_=Array(),k=7,q=12,C=17,x=22,I=5,E=9,N=14,A=20,P=4,z=11,$=16,G=23,L=6,T=10,M=15,R=21;for(e=h(e),_=u(e),y=1732584193,S=4023233417,w=2562383102,j=271733878,f=0;f<_.length;f+=16)m=y,g=S,v=w,b=j,y=s(y,S,w,j,_[f+0],k,3614090360),j=s(j,y,S,w,_[f+1],q,3905402710),w=s(w,j,y,S,_[f+2],C,606105819),S=s(S,w,j,y,_[f+3],x,3250441966),y=s(y,S,w,j,_[f+4],k,4118548399),j=s(j,y,S,w,_[f+5],q,1200080426),w=s(w,j,y,S,_[f+6],C,2821735955),S=s(S,w,j,y,_[f+7],x,4249261313),y=s(y,S,w,j,_[f+8],k,1770035416),j=s(j,y,S,w,_[f+9],q,2336552879),w=s(w,j,y,S,_[f+10],C,4294925233),S=s(S,w,j,y,_[f+11],x,2304563134),y=s(y,S,w,j,_[f+12],k,1804603682),j=s(j,y,S,w,_[f+13],q,4254626195),w=s(w,j,y,S,_[f+14],C,2792965006),S=s(S,w,j,y,_[f+15],x,1236535329),y=c(y,S,w,j,_[f+1],I,4129170786),j=c(j,y,S,w,_[f+6],E,3225465664),w=c(w,j,y,S,_[f+11],N,643717713),S=c(S,w,j,y,_[f+0],A,3921069994),y=c(y,S,w,j,_[f+5],I,3593408605),j=c(j,y,S,w,_[f+10],E,38016083),w=c(w,j,y,S,_[f+15],N,3634488961),S=c(S,w,j,y,_[f+4],A,3889429448),y=c(y,S,w,j,_[f+9],I,568446438),j=c(j,y,S,w,_[f+14],E,3275163606),w=c(w,j,y,S,_[f+3],N,4107603335),S=c(S,w,j,y,_[f+8],A,1163531501),y=c(y,S,w,j,_[f+13],I,2850285829),j=c(j,y,S,w,_[f+2],E,4243563512),w=c(w,j,y,S,_[f+7],N,1735328473),S=c(S,w,j,y,_[f+12],A,2368359562),y=l(y,S,w,j,_[f+5],P,4294588738),j=l(j,y,S,w,_[f+8],z,2272392833),w=l(w,j,y,S,_[f+11],$,1839030562),S=l(S,w,j,y,_[f+14],G,4259657740),y=l(y,S,w,j,_[f+1],P,2763975236),j=l(j,y,S,w,_[f+4],z,1272893353),w=l(w,j,y,S,_[f+7],$,4139469664),S=l(S,w,j,y,_[f+10],G,3200236656),y=l(y,S,w,j,_[f+13],P,681279174),j=l(j,y,S,w,_[f+0],z,3936430074),w=l(w,j,y,S,_[f+3],$,3572445317),S=l(S,w,j,y,_[f+6],G,76029189),y=l(y,S,w,j,_[f+9],P,3654602809),j=l(j,y,S,w,_[f+12],z,3873151461),w=l(w,j,y,S,_[f+15],$,530742520),S=l(S,w,j,y,_[f+2],G,3299628645),y=d(y,S,w,j,_[f+0],L,4096336452),j=d(j,y,S,w,_[f+7],T,1126891415),w=d(w,j,y,S,_[f+14],M,2878612391),S=d(S,w,j,y,_[f+5],R,4237533241),y=d(y,S,w,j,_[f+12],L,1700485571),j=d(j,y,S,w,_[f+3],T,2399980690),w=d(w,j,y,S,_[f+10],M,4293915773),S=d(S,w,j,y,_[f+1],R,2240044497),y=d(y,S,w,j,_[f+8],L,1873313359),j=d(j,y,S,w,_[f+15],T,4264355552),w=d(w,j,y,S,_[f+6],M,2734768916),S=d(S,w,j,y,_[f+13],R,1309151649),y=d(y,S,w,j,_[f+4],L,4149444226),j=d(j,y,S,w,_[f+11],T,3174756917),w=d(w,j,y,S,_[f+2],M,718787259),S=d(S,w,j,y,_[f+9],R,3951481745),y=o(y,m),S=o(S,g),w=o(w,v),j=o(j,b);var O=p(y)+p(S)+p(w)+p(j);return O.toLowerCase()},t=t||80;return"//www.gravatar.com/avatar/"+o(e)+".jpg?s="+t},redirect:function(e,t){d.test(e)||(e="http://developers.arcgis.com"),t&&(t=dojo.objectToQuery(t)),window.location=e+(t?"?"+t:"")},queue:function(e){this.ready?e():this._callbacks.push(e)},avatar:function(e){return this.profile.thumbnail?"https://"+SiteConfig.ago+"/sharing/rest/community/users/"+this.username()+"/info/"+this.profile.thumbnail+"?token="+this.token():this.get_gravatar(this.profile.email,e||18)+"&d=mm"},loggedIn:function(){return!!this.token()},displayName:function(){return this.profile?profile.fullName||this.username()||profile.email||"Your Account":this.username()},orgId:function(){return this.organization?this.organization.id:o("esri_auth")?JSON.parse(o("esri_auth")).accountId:void 0},orgUrlKey:function(){return this.organization?this.organization.urlKey:o("esri_auth")?JSON.parse(o("esri_auth")).urlKey:void 0},orgUrl:function(){if(this.organization){var e=this.organization.allSSL?"https://":"http://";return e+this.orgUrlKey()+SiteConfig.ago_maps}},token:function(){return!!o("esri_auth")&&JSON.parse(o("esri_auth")).token},role:function(){var e=JSON.parse(o("esri_auth"));return!!e&&(!!e.role&&e.role.replace("org_","").replace("account_",""))},isAdmin:function(){return"admin"===this.role()},username:function(){return this.profile?this.profile.username:o("esri_auth")?JSON.parse(o("esri_auth")).email:void 0},userId:function(){return this.username()},requireSession:function(){this.loggedIn()||this.redirect("/sign-in",{redirect_uri:window.encodeURIComponent(window.location.href)})},logout:function(){redirect("https://www.arcgis.com/sharing/rest/oauth2/signout",{redirect_uri:SiteConfig.destination})},developerSubscription:function(){if(this.organization&&this.organization.subscriptionInfo&&("Trial Developer"===this.organization.subscriptionInfo.type||"Developer"===this.organization.subscriptionInfo.type))return!0},developer:function(){return this.developerSubscription()},trial:function(){if(this.organization&&this.organization.subscriptionInfo.type.match(/Trial/))return!0},expired:function(){if(this.organization&&this.organization.subscriptionInfo&&"expired"===this.organization.subscriptionInfo.state)return!0},suspended:function(){if(this.organization&&this.organization.subscriptionInfo&&"suspended"===this.organization.subscriptionInfo.state)return!0},firstName:function(){return this.profile.fullName.split(/ |\.|_/)[0]},finishSignin:function(e){var t=this.isPublicAccount()?"/public-account/":"/applications/",o=l.urlToObject(window.location.href).query,a=o&&o.redirect_uri?o.redirect_uri:t;this.redirect(a)},isPublicAccount:function(){return!!o("esri_auth")&&!JSON.parse(o("esri_auth")).role}});window.ArcGIS=window.ArcGIS||{},window.ArcGIS.Session=new u;var p=o("esri_auth"),h=p?JSON.parse(p):void 0;return h&&!window.ArcGIS.shouldExpireSession&&(c({url:SiteConfig.portal+"/rest/portals/self",content:{token:ArcGIS.Session.token(),f:"json"}}).then(function(e){ArcGIS.Session.profile=e.user,ArcGIS.Session.organization=e,a.publish("session:organization"),c({url:SiteConfig.billing+"/subscription",content:{token:ArcGIS.Session.token(),f:"json"}}).then(function(e){ArcGIS.Session.subscription=e.subscription,ArcGIS.Session.ready=!0;for(var t=ArcGIS.Session._callbacks.length-1;t>=0;t--)ArcGIS.Session._callbacks[t]();a.publish("session:ready")},function(e){ArcGIS.Session.logout(),document.location.reload(!0)})},function(e){ArcGIS.Session.logout(),document.location.reload(!0)}),ArcGIS.Session.queue(function(){var e=ArcGIS.Session.expired()||ArcGIS.Session.suspended(),t=r("#account-alerts").length;if(t&&e){var o=new i(r("#account-notifications")[0]),a=ArcGIS.Session.developer()&&ArcGIS.Session.expired(),n=ArcGIS.Session.developer()&&ArcGIS.Session.suspended(),s=!ArcGIS.Session.developer();if(a&&o.error("It looks like your account has expired. You won't be able to create new applications or feature services until you <a href='/account/modify-plan/'>renew your account</a>."),n&&o.error("Looks like you went over your credit limit for this month. You won't be able to create new applications or feature services. You can either <a href='/account/modify-plan/'>upgrade to a larger plan</a> or wait until next month."),s){var c=" <a href='"+ArcGIS.Session.orgUrl()+"/home/organization.html'>Upgrade Subscription</a>";o.error("Your subscription has been suspended or has expired."+c)}}})),window.ArcGIS.Session});