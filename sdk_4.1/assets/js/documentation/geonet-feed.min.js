/*! ArcGIS API for JavaScript 4.1 | Copyright (c) 2016 Esri. All rights reserved. | http://www.esri.com/legal/privacy | https://developers.arcgis.com/terms/faq */
require(["dojo/query","dojo/dom-construct","dojo/date/locale","dojo/dom-attr","esri/config","esri/request"],function(e,t,a,o,n,r){function s(e){var t=document.createElement("div");t.className="flexible-block-group-item flexible-block-group-item-white";var a=e.resources.html.ref;return t.innerHTML=['<div class="flexible-block-group-item-header">',"<small>"+i(e.published)+"</small>","</div>",'<div class="flexible-block-group-item-content">','<h4 class="leader-half">','<a href="'+a+'">',e.subject+"</a>","</h4>","<p>"+l(e)+"</p>","</div>",'<div class="flexible-block-group-item-footer">','<a href="'+a+'">Continue reading <span class="icon-ui-right icon-ui-small"></span></a>',"</div>"].join("\n"),t}function i(e){var t="";if(e){var o=e.slice(0,-2)+":"+e.slice(-2);t=a.format(new Date(o),{selector:"date",formatLength:"long"})}return t}function l(e){var t=e.content.text.replace(/(<([^>]+)>)/gi,"");return c(t,100)}function c(e,t){return e=e.replace(/[\n]/g," "),e=e.substr(0,t),e=e.substr(0,Math.min(e.length,e.lastIndexOf(" ")))}function d(e){return r(e,{responseType:"json"})}function u(e){for(var t=[],a=0;a<e.length;a++){var o=e[a];o.subject.length&&o.resources.html.ref.length&&o.content.text.length&&t.push(o)}return t}n.request.corsEnabledServers.push("webappsproxy.esri.com"),e("[data-geonet-feed-url]").forEach(function(a){var n=e(a)[0],r=o.get(n,"data-geonet-feed-url"),i=parseInt(o.get(n,"data-post-limit"),10)||10;d(r).then(function(e){for(var a=u(e.data.list),o=0;o<Math.min(a.length,i);o++)t.place(s(a[o]),n)})})});