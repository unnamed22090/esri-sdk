/* calcite-web - v1.0.0-beta.16 - 2016-05-04
*  https://github.com/esri/calcite-web
*  Copyright (c) 2016 Environmental Systems Research Institute, Inc.
*  Apache 2.0 License */!function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?module.exports=factory():"function"==typeof define&&define.amd?define(factory):global.calcite=factory()}(this,function(){"use strict";function has(domNode,className){var elementClass=" "+domNode.className+" ";return-1!==elementClass.indexOf(" "+className+" ")}function add(domNode,classes){classes.split(" ").forEach(function(c){has(domNode,c)||(domNode.className+=" "+c)})}function remove(domNode,classes){var elementClass=" "+domNode.className+" ";classes.split(" ").forEach(function(c){elementClass=elementClass.replace(" "+c+" "," ")}),domNode.className=elementClass.trim()}function toggle(domNode,className){has(domNode,className)?remove(domNode,className):add(domNode,className)}function removeActive(array){array=nodeListToArray(array),array.forEach(function(item){remove(item,"is-active")})}function addActive(array){array=nodeListToArray(array),array.forEach(function(item){add(item,"is-active")})}function toggleActive(array,el){removeActive(array),add(el,"is-active")}function closest(className,context){var current;for(current=context;current&&(1!==current.nodeType||!has(current,className));current=current.parentNode);return current}function nodeListToArray(domNodeList){return Array.isArray(domNodeList)?domNodeList:Array.prototype.slice.call(domNodeList)}function findElements(query,domNode){var context=domNode||document,elements=context.querySelectorAll(query);return nodeListToArray(elements)}function filterArray(value,array){var results=array.filter(function(item){var val=value.toLowerCase(),t=item.innerHTML.toLowerCase();return-1!==t.indexOf(val)});return results}function toggleHidden(array){array.forEach(function(node){var hidden=node.getAttribute("aria-hidden");"true"!==hidden?node.setAttribute("aria-hidden",!0):node.removeAttribute("aria-hidden")})}function hide(array){array.forEach(function(node){node.setAttribute("aria-hidden",!0)})}function show(array){array.forEach(function(node){node.removeAttribute("aria-hidden")})}function toggleExpanded(domNode){var isExpanded=domNode.getAttribute("aria-expanded");isExpanded?domNode.removeAttribute("aria-expanded"):domNode.setAttribute("aria-expanded","true")}function click(){return"click"}function add$1(domNode,e,fn){return domNode.addEventListener?domNode.addEventListener(e,fn,!1):domNode.attachEvent?domNode.attachEvent("on"+e,fn):void 0}function remove$1(domNode,e,fn){return domNode.removeEventListener?domNode.removeEventListener(e,fn,!1):domNode.detachEvent?domNode.detachEvent("on"+e,fn):void 0}function target(e){return e.target||e.srcElement}function preventDefault(e){return e.preventDefault?e.preventDefault():void(e.returnValue&&(e.returnValue=!1))}function stopPropagation(e){return e=e||window.event,e.stopPropagation?e.stopPropagation():void(e.cancelBubble&&(e.cancelBubble=!0))}function throttle(fn,time,context){var lock,args,wrapperFn,later;return later=function(){lock=!1,args&&(wrapperFn.apply(context,args),args=!1)},wrapperFn=function(){lock?args=arguments:(fn.apply(context,arguments),setTimeout(later,time),lock=!0)}}function E(){}function accordion(){function bindAccordions(options){options?setUpAccordion(options.node):accordions.forEach(function(accordion){setUpAccordion(accordion)})}function setUpAccordion(accordion){accordion.setAttribute("aria-live","polite"),accordion.setAttribute("role","tablist"),nodeListToArray(accordion.children).forEach(function(section){var sectionTitle=section.querySelector(".accordion-title");sectionTitle.setAttribute("role","tab"),sectionTitle.setAttribute("tabindex","0"),has(section,"is-active")&&section.setAttribute("aria-expanded","true"),add$1(sectionTitle,click(),toggleClick),add$1(section,"keyup",function(e){13===e.keyCode&&toggleClick(e)})})}function toggleClick(e){stopPropagation(e);var parent=closest("accordion-section",target(e));bus.emit("accordion:toggle",{node:parent})}function handleToggle(options){toggle(options.node,"is-active"),toggleExpanded(options.node)}var accordions=findElements(".js-accordion");bus.on("accordion:bind",bindAccordions),bus.on("accordion:toggle",handleToggle),bus.emit("accordion:bind")}function closeAllDropdowns(options){remove$1(document.body,click(),closeAllDropdowns),findElements(".js-dropdown").forEach(function(dropdown){remove(dropdown,"is-active")}),findElements(".js-dropdown-toggle").forEach(function(toggle){toggle.setAttribute("aria-expanded","false")})}function toggleDropdown(options){if(options){var isOpen=has(options.node,"is-active");bus.emit("dropdown:close"),isOpen||(add(options.node,"is-active"),options.target&&options.target.setAttribute("aria-expanded","true")),has(options.node,"is-active")&&add$1(document.body,click(),closeAllDropdowns)}}function bindDropdowns(options){var toggles=findElements(".js-dropdown-toggle");toggles.forEach(function(toggle){var eventExists=!1;boundEvents.dropdowns.forEach(function(e){e.target===toggle&&e.event===click()&&e.fn===toggleClick&&(eventExists=!0)}),eventExists||(boundEvents.dropdowns.push({target:toggle,event:click(),fn:toggleClick}),add$1(toggle,click(),toggleClick))})}function toggleClick(e){preventDefault(e),stopPropagation(e);var dropdown=closest("js-dropdown",e.target);bus.emit("dropdown:toggle",{node:dropdown,target:e.target})}function addListeners(){bus.on("dropdown:toggle",toggleDropdown),bus.on("dropdown:close",closeAllDropdowns),bus.on("keyboard:escape",closeAllDropdowns),listenersAdded=!0}function dropdown(){listenersAdded||addListeners(),bindDropdowns()}function drawer(){function openDrawer(options){bus.emit("drawer:close");var drawer=document.querySelector('.js-drawer[data-drawer="'+options.id+'"]'),right=has(drawer,"drawer-right"),left=has(drawer,"drawer-left");drawer.setAttribute("tabindex",0),add(drawer,"is-active"),right?add(wrapper,"drawer-right-is-active"):left&&add(wrapper,"drawer-left-is-active"),hide([wrapper,footer]),add$1(drawer,click(),closeClick),add$1(document,"focusin",fenceDrawer)}function closeDrawer(options){if(options){var drawer=document.querySelector('.js-drawer[data-drawer="'+options.id+'"]');drawer.removeAttribute("tabindex"),remove(drawer,"is-active")}else drawers.forEach(function(drawer){drawer.removeAttribute("tabindex"),remove(drawer,"is-active")});remove(wrapper,"drawer-left-is-active"),remove(wrapper,"drawer-right-is-active"),show([wrapper,footer]),remove$1(document,"focusin",fenceDrawer),lastOn&&lastOn.focus()}function fenceDrawer(e){closest("js-drawer",e.target)||drawers.forEach(function(drawer){has(drawer,"is-active")&&drawer.focus()})}function bindDrawers(options){options?add$1(options.node,click(),toggleClick):toggles.forEach(function(toggle){add$1(toggle,click(),toggleClick)})}function closeClick(e){has(e.target,"js-drawer")&&bus.emit("drawer:close")}function toggleClick(e){preventDefault(e);var drawerId=e.target.getAttribute("data-drawer");bus.emit("drawer:open",{id:drawerId})}var lastOn,wrapper=document.querySelector(".wrapper"),footer=document.querySelector(".footer"),toggles=findElements(".js-drawer-toggle"),drawers=findElements(".js-drawer");bus.on("drawer:open",openDrawer),bus.on("keyboard:escape",closeDrawer),bus.on("drawer:close",closeDrawer),bus.on("drawer:bind",bindDrawers),bus.emit("drawer:bind")}function expander(){var toggles=findElements(".js-expand-toggle"),sections=document.querySelectorAll(".js-expand");toggles.forEach(function(toggle){add$1(toggle,click(),function(e){preventDefault(e);var sectionId=toggle.getAttribute("data-expand"),section=document.querySelector('.js-expand[data-expand="'+sectionId+'"]'),isOpen=has(section,"is-active"),shouldClose=has(section,"is-active");toggleActive(sections,section),isOpen&&shouldClose?remove(section,"is-active"):add(section,"is-active")})})}function filterDropdown(){function bindFilterDropdowns(){var dropdowns=findElements(".js-filter-dropdown");dropdowns.forEach(function(dropdown){var dropdownId=dropdown.getAttribute("data-filter-dropdown"),input=dropdown.querySelector(".filter-dropdown-input");add$1(input,"focus",inputFocus);for(var opens=dropdown.querySelectorAll(".js-filter-dropdown-open"),i=0;i<opens.length;i++){var open=opens[i];open.setAttribute("data-id",dropdownId),add$1(open,click(),toggleClick)}for(var closes=dropdown.querySelectorAll(".js-filter-dropdown-close"),i=0;i<closes.length;i++){var close=closes[i];close.setAttribute("data-id",dropdownId),add$1(close,click(),toggleClick)}for(var items=dropdown.querySelectorAll(".filter-dropdown-link"),i=0;i<items.length;i++){var item=items[i];item.setAttribute("data-item-id",i),add$1(item,click(),itemClick)}add$1(input,"keyup",function(e){var itemsArray=nodeListToArray(items);itemsArray.forEach(function(item){add(item,"hide")}),filterArray(input.value,itemsArray).forEach(function(item){remove(item,"hide")})})})}function getOptions(e){var parent=closest("js-filter-dropdown",e.target);return{parent:parent,id:parent.getAttribute("data-filter-dropdown"),item:e.target}}function inputFocus(e){stopPropagation(e);var options=getOptions(e);bus.emit("filterDropdown:input:focus",options)}function itemClick(e){preventDefault(e),stopPropagation(e);var options=getOptions(e);bus.emit("filterDropdown:select",options)}function toggleClick(e){e.preventDefault();var options=getOptions(e);toggle(e.target,"is-active"),bus.emit("filterDropdown:toggle",options)}function toggleDropdown(options){var list=options.parent.querySelector(".filter-dropdown-list");has(list,"is-active")?bus.emit("filterDropdown:close",options):bus.emit("filterDropdown:open",options)}function toggleItem(options){toggle(options.item,"is-active")}function removeItem(options){var activeItems=options.parent.querySelectorAll(".filter-dropdown-link.is-active"),toRemove=activeItems[options.i];remove(toRemove,"is-active");var newActiveItems=options.parent.querySelectorAll(".filter-dropdown-link.is-active"),emit={parent:options.parent,id:options.id,active:newActiveItems};bus.emit("filterDropdown:active",emit)}function openList(options){closeList();var list=options.parent.querySelector(".filter-dropdown-list");add(list,"is-active");var closes=findElements(".js-filter-dropdown-close",options.parent),opens=findElements(".js-filter-dropdown-open",options.parent);opens.forEach(function(el){return remove(el,"is-active")}),closes.forEach(function(el){return add(el,"is-active")})}function closeList(e){var lists=document.querySelectorAll(".filter-dropdown-list");removeActive(lists);var opens=findElements(".js-filter-dropdown-open"),closes=findElements(".js-filter-dropdown-close");opens.forEach(function(el){return add(el,"is-active")}),closes.forEach(function(el){return remove(el,"is-active")})}function emitActive(options){var activeItems=options.parent.querySelectorAll(".filter-dropdown-link.is-active"),emit={parent:options.parent,id:options.id,active:activeItems};bus.emit("filterDropdown:active",emit)}function drawActive(options){bus.emit("filterDropdown:active:clear",options);var placeholder=options.parent.querySelector(".js-flilter-dropdown-no-filters");options.active.length>0?add(placeholder,"hide"):remove(placeholder,"hide");for(var i=0;i<options.active.length;i++){var item=options.active[i],template='<span class="filter-dropdown-active">'+item.innerHTML+'<a class="filter-dropdown-remove" href="#" data-item-id=\''+i+"'></a></span>";options.parent.insertAdjacentHTML("beforeend",template);var remove$$=options.parent.querySelector('.filter-dropdown-remove[data-item-id="'+i+'"]');add$1(remove$$,click(),removeClick)}}function removeClick(e){e.preventDefault();var options=getOptions(e);options.i=e.target.getAttribute("data-item-id"),bus.emit("filterDropdown:select:remove",options)}function clearActive(options){for(var current=options.parent.querySelectorAll(".filter-dropdown-active"),i=0;i<current.length;i++)options.parent.removeChild(current[i])}bus.on("filterDropdown:bind",bindFilterDropdowns),bus.on("filterDropdown:select",toggleItem),bus.on("filterDropdown:select",emitActive),bus.on("filterDropdown:select:remove",removeItem),bus.on("filterDropdown:active",drawActive),bus.on("filterDropdown:active:clear",clearActive),bus.on("filterDropdown:toggle",toggleDropdown),bus.on("filterDropdown:open",openList),bus.on("filterDropdown:close",closeList),bus.on("keyboard:escape",closeList),bus.emit("filterDropdown:bind")}function modal(){function openModal(modalId){if(bus.emit("modal:close"),modalId){var modal=document.querySelector('.js-modal[data-modal="'+modalId+'"]');modal.removeAttribute("tabindex"),add$1(document,"focusin",fenceModal),add(modal,"is-active"),hide([wrapper,footer]),modal.focus()}}function closeModal(modalId){if(!modalId)return removeActive(modals);var modal=document.querySelector('.js-modal[data-modal="'+modalId+'"]');remove(modal,"is-active"),modal.setAttribute("tabindex",0),remove$1(document,"focusin",fenceModal),show([wrapper,footer])}function bindModals(node){node?add$1(node,click(),toggleClick):toggles.forEach(function(toggle){add$1(toggle,click(),toggleClick)})}function fenceModal(e){closest("js-modal",e.target)||modals.forEach(function(modal){has(modal,"is-active")&&modal.focus()})}function toggleClick(e){preventDefault(e);var modalId=e.target.dataset.modal;bus.emit("modal:open",modalId)}var wrapper=document.querySelector(".wrapper"),footer=document.querySelector(".footer"),toggles=findElements(".js-modal-toggle"),modals=findElements(".js-modal");bus.on("modal:open",openModal),bus.on("keyboard:escape",closeModal),bus.on("modal:close",closeModal),bus.on("modal:bind",bindModals),bus.emit("modal:bind")}function search(){function toggleForm(e){var searchContainer=closest("js-site-search",e.target),isOpen=has(searchContainer,"is-active");isOpen?(remove(searchContainer,"is-active"),e.target.value=""):add(searchContainer,"is-active")}var searchForms=findElements(".js-site-search");searchForms.forEach(function(search){add$1(search,"focusin",toggleForm),add$1(search,"focusout",toggleForm)})}function selectNav(){function bindSelects(){selects.forEach(function(select){add$1(select,"change",selectPage)})}function selectPage(e){window.location.assign(e.currentTarget.value)}bus.on("selectnav:bind",bindSelects);var selects=findElements(".js-select-nav");bus.emit("selectnav:bind")}function gen(count){for(var out="",i=0;count>i;i++)out+=(65536*(1+Math.random())|0).toString(16).substring(1);return out}function Guid(guid){if(!guid)throw new TypeError("Invalid argument `value` has no value.");this.value=Guid.EMPTY,guid&&guid instanceof Guid?this.value=guid.toString():guid&&"[object String]"===Object.prototype.toString.call(guid)&&Guid.isGuid(guid)&&(this.value=guid),this.equals=function(other){return Guid.isGuid(other)&&this.value===other},this.isEmpty=function(){return this.value===Guid.EMPTY},this.toString=function(){return this.value},this.toJSON=function(){return this.value}}function sticky(){function createShim(el){var guid=Guid.raw();el.setAttribute("data-sticky-id",guid);var parent=el.parentNode,shim=el.cloneNode("deep");add(shim,"js-shim"),remove(shim,"js-sticky"),shim.setAttribute("data-sticky-id",guid),shim.style.visibility="hidden",shim.style.display="none",parent.insertBefore(shim,el)}function stickItem(item){var id=item.element.getAttribute("data-sticky-id"),shim=document.querySelector('.js-shim[data-sticky-id="'+id+'"]');id&&shim&&(add(item.element,"is-sticky"),shim.style.display="")}function unstickItem(item){var id=item.element.getAttribute("data-sticky-id"),shim=document.querySelector('.js-shim[data-sticky-id="'+id+'"]');id&&shim&&(remove(item.element,"is-sticky"),shim.style.display="none")}function scrollHandler(pageYOffset){stickies.forEach(function(item){var referenceElement=item.element;if(has(item.element,"is-sticky")){var id=item.element.getAttribute("data-sticky-id");referenceElement=document.querySelector('.js-shim[data-sticky-id="'+id+'"]')}if(referenceElement){var dataTop=referenceElement.getAttribute("data-top")||0;item.top=referenceElement.offsetTop-parseInt(dataTop,0)}item.top<pageYOffset?bus.emit("sticky:stick",item):bus.emit("sticky:unstick",item)})}bus.on("scrolling:at",scrollHandler),bus.on("sticky:stick",stickItem),bus.on("sticky:unstick",unstickItem);var elements=findElements(".js-sticky"),stickies=elements.map(function(el){var offset=el.offsetTop,dataTop=el.getAttribute("data-top")||0;el.style.top=dataTop+"px";var hasId=el.getAttribute("data-sticky-id");return hasId||createShim(el),{top:offset-parseInt(dataTop,0),element:el}})}function tabs(){function bindTabs(){var tabs=findElements(".js-tab"),tabGroups=findElements(".js-tab-group"),tabSections=findElements(".js-tab-section");tabGroups.forEach(function(tab){tab.setAttribute("aria-live","polite"),groupId(tab),tab.children[0].setAttribute("role","tablist");for(var tabsInGroup=tab.querySelectorAll(".js-tab"),percent=100/tabsInGroup.length,i=0;i<tabsInGroup.length;i++)tabsInGroup[i].style.maxWidth=percent+"%"}),tabs.forEach(function(tab){tab.setAttribute("aria-expanded","false"),tab.setAttribute("role","tab"),tab.setAttribute("tabindex","0"),add$1(tab,click(),clickTab),add$1(tab,"keyup",enterTab)}),tabSections.forEach(function(section){section.setAttribute("role","tabpanel");var isOpen=has(section,"is-active");isOpen?section.setAttribute("aria-expanded",!0):section.setAttribute("aria-expanded",!1)})}function groupId(tab){var hasId=tab.getAttribute("data-tab");if(hasId)return hasId;var id=Guid.raw();return tab.setAttribute("data-tab",id),id}function setTab(options){var group=options.parent,tabs=nodeListToArray(group.querySelectorAll(".js-tab")),activeTab=options.active,sections=nodeListToArray(group.querySelectorAll(".js-tab-section")),index=tabs.indexOf(activeTab),activeSection=sections[index];tabs.forEach(function(t){t.setAttribute("aria-expanded",!1)}),activeTab.setAttribute("aria-expanded",!0),toggleActive(tabs,activeTab),sections.forEach(function(s){s.setAttribute("aria-expanded",!1)}),activeSection.setAttribute("aria-expanded",!0),toggleActive(sections,activeSection)}function getOptions(e){var tab=e.target,group=closest("js-tab-group",tab),id=groupId(group);return{parent:group,id:id,active:tab}}function clickTab(e){e.preventDefault();var options=getOptions(e);bus.emit("tabs:active",options)}function enterTab(e){var options=getOptions(e);13===e.keycode&&bus.emit("tabs:active",options)}bus.on("tabs:bind",bindTabs),bus.on("tabs:active",setTab),bus.emit("tabs:bind")}function thirdNav(){function scroll(distance){nav.scrollLeft+=distance}function resize(){remove(leftBtn,"is-active"),remove(rightBtn,"is-active"),nav.scrollLeft>0&&add(leftBtn,"is-active"),nav.scrollLeft+nav.clientWidth+5<nav.scrollWidth&&add(rightBtn,"is-active")}var nav=findElements(".js-nav-overflow")[0],leftBtn=findElements(".js-overflow-left")[0],rightBtn=findElements(".js-overflow-right")[0];nav&&(add$1(leftBtn,click(),scroll.bind(null,-40)),add$1(rightBtn,click(),scroll.bind(null,40)),add$1(nav,"scroll",resize),add$1(window,"resize",resize),resize())}function translateKeypress(e){27===e.keyCode?bus.emit("keyboard:escape"):13===e.keyCode?bus.emit("keyboard:return"):32===e.keyCode?bus.emit("keyboard:space"):38===e.keyCode?bus.emit("keyboard:arrow:up"):40===e.keyCode?bus.emit("keyboard:arrow:down"):37===e.keyCode?bus.emit("keyboard:arrow:left"):39===e.keyCode&&bus.emit("keyboard:arrow:right")}function isScrolling(){bus.emit("scrolling:at",window.pageYOffset)}function init(){accordion(),dropdown(),drawer(),expander(),filterDropdown(),modal(),search(),selectNav(),sticky(),tabs(),thirdNav()}var boundEvents={dropdowns:[]};E.prototype={on:function(name,callback,ctx){var e=this.e||(this.e={});return(e[name]||(e[name]=[])).push({fn:callback,ctx:ctx}),this},once:function(name,callback,ctx){function listener(){self.off(name,listener),callback.apply(ctx,arguments)}var self=this;return listener._=callback,this.on(name,listener,ctx)},emit:function(name){var data=[].slice.call(arguments,1),evtArr=((this.e||(this.e={}))[name]||[]).slice(),i=0,len=evtArr.length;for(i;len>i;i++)evtArr[i].fn.apply(evtArr[i].ctx,data);return this},off:function(name,callback){var e=this.e||(this.e={}),evts=e[name],liveEvents=[];if(evts&&callback)for(var i=0,len=evts.length;len>i;i++)evts[i].fn!==callback&&evts[i].fn._!==callback&&liveEvents.push(evts[i]);return liveEvents.length?e[name]=liveEvents:delete e[name],this}};var bus=new E,listenersAdded=!1,validator=new RegExp("^[a-z0-9]{8}-[a-z0-9]{4}-[a-z0-9]{4}-[a-z0-9]{4}-[a-z0-9]{12}$","i");Guid.EMPTY="00000000-0000-0000-0000-000000000000",Guid.isGuid=function(value){return value&&(value instanceof Guid||validator.test(value.toString()))},Guid.create=function(){return new Guid([gen(2),gen(1),gen(1),gen(1),gen(3)].join("-"))},Guid.raw=function(){return[gen(2),gen(1),gen(1),gen(1),gen(3)].join("-")},add$1(document,"keyup",translateKeypress),add$1(window,"scroll",throttle(isScrolling,100));var calciteWeb={version:"1.0.0-beta.16",click:click,addEvent:add$1,removeEvent:remove$1,eventTarget:target,preventDefault:preventDefault,stopPropagation:stopPropagation,throttle:throttle,hasClass:has,addClass:add,removeClass:remove,toggleClass:toggle,removeActive:removeActive,addActive:addActive,toggleActive:toggleActive,toggleAriaHidden:toggleHidden,toggleAriaExpanded:toggleExpanded,closest:closest,nodeListToArray:nodeListToArray,findElements:findElements,bus:bus,accordion:accordion,dropdown:dropdown,drawers:drawer,expander:expander,filterDropdown:filterDropdown,modal:modal,search:search,selectNav:selectNav,sticky:sticky,tabs:tabs,thirdNav:thirdNav,init:init};return calciteWeb});